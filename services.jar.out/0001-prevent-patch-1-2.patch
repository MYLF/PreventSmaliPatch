From 017d7712787310bc07ee12a9a72f4b025486eddd Mon Sep 17 00:00:00 2001
From: wzv5 <wzv5@msn.com>
Date: Wed, 28 Mar 2018 20:06:25 +0800
Subject: [PATCH] prevent patch [1/2]

---
 smali/com/android/server/IntentResolver.smali      |   4 +-
 .../am/-$Lambda$5yQSwWrsRDcxoFuTXgyaBIqPvDw.smali  |   2 +-
 .../-$Lambda$njIALZ9XLXuT-vhmazyQkVX7Z0U$1.smali   |   2 +-
 .../am/-$Lambda$njIALZ9XLXuT-vhmazyQkVX7Z0U.smali  |   2 +-
 .../am/-$Lambda$wXoCvN1vCS9Im-C0Hwk121gFGr0.smali  |   2 +-
 .../android/server/am/ActivityManagerService.smali | 365 ++++++++--
 smali/com/android/server/am/ActivityStack.smali    |  16 +
 .../server/am/ActivityStackSupervisor.smali        | 746 +++++++++++----------
 smali/com/android/server/am/PreventRunning.smali   | 656 ++++++++++++++++++
 .../com/android/server/am/PreventRunningHook.smali |  70 ++
 .../android/server/am/PreventRunningUtils.smali    | 488 ++++++++++++++
 .../-$Lambda$0oXbfIRCVxclfVVwXaE3J61tRFA$1.smali   |   2 +-
 .../-$Lambda$0oXbfIRCVxclfVVwXaE3J61tRFA$2.smali   |   4 +-
 .../-$Lambda$0oXbfIRCVxclfVVwXaE3J61tRFA$3.smali   |   2 +-
 .../-$Lambda$0oXbfIRCVxclfVVwXaE3J61tRFA.smali     |   2 +-
 .../NotificationManagerService$16.smali            |   2 +-
 .../NotificationManagerService$17.smali            |   2 +-
 .../NotificationManagerService$7.smali             |  23 +
 ...ationManagerService$NotificationListeners.smali |   4 +-
 .../notification/NotificationManagerService.smali  |   2 +-
 .../server/notification/RankingHelper.smali        |   2 +-
 21 files changed, 1978 insertions(+), 420 deletions(-)
 create mode 100644 smali/com/android/server/am/PreventRunning.smali
 create mode 100644 smali/com/android/server/am/PreventRunningHook.smali
 create mode 100644 smali/com/android/server/am/PreventRunningUtils.smali

diff --git a/smali/com/android/server/IntentResolver.smali b/smali/com/android/server/IntentResolver.smali
index af0322e..08019e9 100644
--- a/smali/com/android/server/IntentResolver.smali
+++ b/smali/com/android/server/IntentResolver.smali
@@ -311,7 +311,7 @@
     move-result-object v19
 
     .local v19, "packageName":Ljava/lang/String;
-    invoke-virtual/range {p1 .. p1}, Landroid/content/Intent;->isExcludingStopped()Z
+    invoke-static/range {p1 .. p1}, Lcom/android/server/am/PreventRunningUtils;->isExcludingStopped(Landroid/content/Intent;)Z
 
     move-result v12
 
@@ -601,7 +601,7 @@
 
     move-object/from16 v8, p2
 
-    invoke-virtual/range {v3 .. v9}, Landroid/content/IntentFilter;->match(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Landroid/net/Uri;Ljava/util/Set;Ljava/lang/String;)I
+    invoke-static/range {v3 .. v9}, Lcom/android/server/am/PreventRunningUtils;->match(Landroid/content/IntentFilter;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Landroid/net/Uri;Ljava/util/Set;Ljava/lang/String;)I
 
     move-result v17
 
diff --git a/smali/com/android/server/am/-$Lambda$5yQSwWrsRDcxoFuTXgyaBIqPvDw.smali b/smali/com/android/server/am/-$Lambda$5yQSwWrsRDcxoFuTXgyaBIqPvDw.smali
index 62b603b..ee999fa 100644
--- a/smali/com/android/server/am/-$Lambda$5yQSwWrsRDcxoFuTXgyaBIqPvDw.smali
+++ b/smali/com/android/server/am/-$Lambda$5yQSwWrsRDcxoFuTXgyaBIqPvDw.smali
@@ -28,7 +28,7 @@
 
     iget-boolean v2, p0, Lcom/android/server/am/-$Lambda$5yQSwWrsRDcxoFuTXgyaBIqPvDw;->-$f0:Z
 
-    invoke-virtual {v0, v1, v2}, Lcom/android/server/am/ActivityStackSupervisor;->lambda$-com_android_server_am_ActivityStackSupervisor_113947(IZ)V
+    invoke-virtual {v0, v1, v2}, Lcom/android/server/am/ActivityStackSupervisor;->lambda$-com_android_server_am_ActivityStackSupervisor_114013(IZ)V
 
     return-void
 .end method
diff --git a/smali/com/android/server/am/-$Lambda$njIALZ9XLXuT-vhmazyQkVX7Z0U$1.smali b/smali/com/android/server/am/-$Lambda$njIALZ9XLXuT-vhmazyQkVX7Z0U$1.smali
index 10f34f3..3e55987 100644
--- a/smali/com/android/server/am/-$Lambda$njIALZ9XLXuT-vhmazyQkVX7Z0U$1.smali
+++ b/smali/com/android/server/am/-$Lambda$njIALZ9XLXuT-vhmazyQkVX7Z0U$1.smali
@@ -30,7 +30,7 @@
 
     check-cast v2, Landroid/app/PictureInPictureParams;
 
-    invoke-virtual {v0, v1, v2}, Lcom/android/server/am/ActivityManagerService;->lambda$-com_android_server_am_ActivityManagerService_351999(Lcom/android/server/am/ActivityRecord;Landroid/app/PictureInPictureParams;)V
+    invoke-virtual {v0, v1, v2}, Lcom/android/server/am/ActivityManagerService;->lambda$-com_android_server_am_ActivityManagerService_353758(Lcom/android/server/am/ActivityRecord;Landroid/app/PictureInPictureParams;)V
 
     return-void
 .end method
diff --git a/smali/com/android/server/am/-$Lambda$njIALZ9XLXuT-vhmazyQkVX7Z0U.smali b/smali/com/android/server/am/-$Lambda$njIALZ9XLXuT-vhmazyQkVX7Z0U.smali
index 71b8518..3f01441 100644
--- a/smali/com/android/server/am/-$Lambda$njIALZ9XLXuT-vhmazyQkVX7Z0U.smali
+++ b/smali/com/android/server/am/-$Lambda$njIALZ9XLXuT-vhmazyQkVX7Z0U.smali
@@ -33,7 +33,7 @@
     .param p1, "arg0"    # Lcom/android/internal/os/ProcessCpuTracker$Stats;
 
     .prologue
-    invoke-static {p1}, Lcom/android/server/am/ActivityManagerService;->lambda$-com_android_server_am_ActivityManagerService_768461(Lcom/android/internal/os/ProcessCpuTracker$Stats;)Z
+    invoke-static {p1}, Lcom/android/server/am/ActivityManagerService;->lambda$-com_android_server_am_ActivityManagerService_770506(Lcom/android/internal/os/ProcessCpuTracker$Stats;)Z
 
     move-result v0
 
diff --git a/smali/com/android/server/am/-$Lambda$wXoCvN1vCS9Im-C0Hwk121gFGr0.smali b/smali/com/android/server/am/-$Lambda$wXoCvN1vCS9Im-C0Hwk121gFGr0.smali
index 19ad78d..c3b1d5d 100644
--- a/smali/com/android/server/am/-$Lambda$wXoCvN1vCS9Im-C0Hwk121gFGr0.smali
+++ b/smali/com/android/server/am/-$Lambda$wXoCvN1vCS9Im-C0Hwk121gFGr0.smali
@@ -22,7 +22,7 @@
 
     iget v1, p0, Lcom/android/server/am/-$Lambda$wXoCvN1vCS9Im-C0Hwk121gFGr0;->-$f0:I
 
-    invoke-virtual {v0, v1}, Lcom/android/server/am/ActivityStackSupervisor;->lambda$-com_android_server_am_ActivityStackSupervisor_122545(I)V
+    invoke-virtual {v0, v1}, Lcom/android/server/am/ActivityStackSupervisor;->lambda$-com_android_server_am_ActivityStackSupervisor_122611(I)V
 
     return-void
 .end method
diff --git a/smali/com/android/server/am/ActivityManagerService.smali b/smali/com/android/server/am/ActivityManagerService.smali
index d4c94e8..0262672 100644
--- a/smali/com/android/server/am/ActivityManagerService.smali
+++ b/smali/com/android/server/am/ActivityManagerService.smali
@@ -20436,6 +20436,31 @@
 .end method
 
 .method private final handleAppDiedLocked(Lcom/android/server/am/ProcessRecord;ZZ)V
+    .locals 1
+    .param p1, "app"    # Lcom/android/server/am/ProcessRecord;
+    .param p2, "restarting"    # Z
+    .param p3, "allowRestart"    # Z
+
+    .prologue
+    invoke-direct {p0, p1, p2, p3}, Lcom/android/server/am/ActivityManagerService;->handleAppDiedLocked$Pr(Lcom/android/server/am/ProcessRecord;ZZ)V
+
+    if-nez p2, :cond_0
+
+    if-eqz p3, :cond_0
+
+    iget-boolean v0, p1, Lcom/android/server/am/ProcessRecord;->killedByAm:Z
+
+    xor-int/lit8 v0, v0, 0x1
+
+    if-eqz v0, :cond_0
+
+    invoke-static {p1}, Lcom/android/server/am/PreventRunningUtils;->onAppDied(Lcom/android/server/am/ProcessRecord;)V
+
+    :cond_0
+    return-void
+.end method
+
+.method private final handleAppDiedLocked$Pr(Lcom/android/server/am/ProcessRecord;ZZ)V
     .locals 10
     .param p1, "app"    # Lcom/android/server/am/ProcessRecord;
     .param p2, "restarting"    # Z
@@ -21896,6 +21921,11 @@
     move-result v11
 
     :goto_3
+    invoke-static {v11}, Lcom/android/server/am/PreventRunningUtils;->returnFalse(Z)Z
+
+    move-result v11
+
+    .local v11, "isDep":Z
     if-nez v11, :cond_6
 
     iget v13, v6, Lcom/android/server/am/ProcessRecord;->uid:I
@@ -21936,6 +21966,7 @@
 
     goto :goto_2
 
+    .end local v11    # "isDep":Z
     :cond_8
     const/4 v11, 0x0
 
@@ -22152,7 +22183,7 @@
     throw v6
 .end method
 
-.method static synthetic lambda$-com_android_server_am_ActivityManagerService_768461(Lcom/android/internal/os/ProcessCpuTracker$Stats;)Z
+.method static synthetic lambda$-com_android_server_am_ActivityManagerService_770506(Lcom/android/internal/os/ProcessCpuTracker$Stats;)Z
     .locals 4
     .param p0, "st"    # Lcom/android/internal/os/ProcessCpuTracker$Stats;
 
@@ -34151,6 +34182,57 @@
 .end method
 
 .method public bindService(Landroid/app/IApplicationThread;Landroid/os/IBinder;Landroid/content/Intent;Ljava/lang/String;Landroid/app/IServiceConnection;ILjava/lang/String;I)I
+    .locals 1
+    .param p1, "caller"    # Landroid/app/IApplicationThread;
+    .param p2, "token"    # Landroid/os/IBinder;
+    .param p3, "service"    # Landroid/content/Intent;
+    .param p4, "resolvedType"    # Ljava/lang/String;
+    .param p5, "connection"    # Landroid/app/IServiceConnection;
+    .param p6, "flags"    # I
+    .param p7, "callingPackage"    # Ljava/lang/String;
+    .param p8, "userId"    # I
+    .annotation system Ldalvik/annotation/Throws;
+        value = {
+            Landroid/os/TransactionTooLargeException;
+        }
+    .end annotation
+
+    .prologue
+    :try_start_0
+    invoke-static {p1}, Lcom/android/server/am/PreventRunningUtils;->setSender(Landroid/app/IApplicationThread;)V
+
+    invoke-static {p1, p2, p3}, Lcom/android/server/am/PreventRunningUtils;->hookBindService(Landroid/app/IApplicationThread;Landroid/os/IBinder;Landroid/content/Intent;)Z
+
+    move-result v0
+
+    if-eqz v0, :cond_0
+
+    invoke-virtual/range {p0 .. p8}, Lcom/android/server/am/ActivityManagerService;->bindService$Pr(Landroid/app/IApplicationThread;Landroid/os/IBinder;Landroid/content/Intent;Ljava/lang/String;Landroid/app/IServiceConnection;ILjava/lang/String;I)I
+    :try_end_0
+    .catchall {:try_start_0 .. :try_end_0} :catchall_0
+
+    move-result v0
+
+    invoke-static {}, Lcom/android/server/am/PreventRunningUtils;->clearSender()V
+
+    return v0
+
+    :cond_0
+    const/4 v0, 0x0
+
+    invoke-static {}, Lcom/android/server/am/PreventRunningUtils;->clearSender()V
+
+    return v0
+
+    :catchall_0
+    move-exception v0
+
+    invoke-static {}, Lcom/android/server/am/PreventRunningUtils;->clearSender()V
+
+    throw v0
+.end method
+
+.method public bindService$Pr(Landroid/app/IApplicationThread;Landroid/os/IBinder;Landroid/content/Intent;Ljava/lang/String;Landroid/app/IServiceConnection;ILjava/lang/String;I)I
     .locals 9
     .param p1, "caller"    # Landroid/app/IApplicationThread;
     .param p2, "token"    # Landroid/os/IBinder;
@@ -34293,6 +34375,51 @@
 .end method
 
 .method public final broadcastIntent(Landroid/app/IApplicationThread;Landroid/content/Intent;Ljava/lang/String;Landroid/content/IIntentReceiver;ILjava/lang/String;Landroid/os/Bundle;[Ljava/lang/String;ILandroid/os/Bundle;ZZI)I
+    .locals 2
+    .param p1, "caller"    # Landroid/app/IApplicationThread;
+    .param p2, "intent"    # Landroid/content/Intent;
+    .param p3, "resolvedType"    # Ljava/lang/String;
+    .param p4, "resultTo"    # Landroid/content/IIntentReceiver;
+    .param p5, "resultCode"    # I
+    .param p6, "resultData"    # Ljava/lang/String;
+    .param p7, "resultExtras"    # Landroid/os/Bundle;
+    .param p8, "requiredPermissions"    # [Ljava/lang/String;
+    .param p9, "appOp"    # I
+    .param p10, "bOptions"    # Landroid/os/Bundle;
+    .param p11, "serialized"    # Z
+    .param p12, "sticky"    # Z
+    .param p13, "userId"    # I
+
+    .prologue
+    :try_start_0
+    invoke-static {p1}, Lcom/android/server/am/PreventRunningUtils;->setSender(Landroid/app/IApplicationThread;)V
+
+    invoke-virtual/range {p0 .. p13}, Lcom/android/server/am/ActivityManagerService;->broadcastIntent$Pr(Landroid/app/IApplicationThread;Landroid/content/Intent;Ljava/lang/String;Landroid/content/IIntentReceiver;ILjava/lang/String;Landroid/os/Bundle;[Ljava/lang/String;ILandroid/os/Bundle;ZZI)I
+
+    move-result v0
+
+    .local v0, "res":I
+    if-nez v0, :cond_0
+
+    invoke-static {p2}, Lcom/android/server/am/PreventRunningUtils;->onBroadcastIntent(Landroid/content/Intent;)V
+    :try_end_0
+    .catchall {:try_start_0 .. :try_end_0} :catchall_0
+
+    :cond_0
+    invoke-static {}, Lcom/android/server/am/PreventRunningUtils;->clearSender()V
+
+    return v0
+
+    .end local v0    # "res":I
+    :catchall_0
+    move-exception v1
+
+    invoke-static {}, Lcom/android/server/am/PreventRunningUtils;->clearSender()V
+
+    throw v1
+.end method
+
+.method public final broadcastIntent$Pr(Landroid/app/IApplicationThread;Landroid/content/Intent;Ljava/lang/String;Landroid/content/IIntentReceiver;ILjava/lang/String;Landroid/os/Bundle;[Ljava/lang/String;ILandroid/os/Bundle;ZZI)I
     .locals 22
     .param p1, "caller"    # Landroid/app/IApplicationThread;
     .param p2, "intent"    # Landroid/content/Intent;
@@ -72958,7 +73085,7 @@
     throw v0
 .end method
 
-.method synthetic lambda$-com_android_server_am_ActivityManagerService_351999(Lcom/android/server/am/ActivityRecord;Landroid/app/PictureInPictureParams;)V
+.method synthetic lambda$-com_android_server_am_ActivityManagerService_353758(Lcom/android/server/am/ActivityRecord;Landroid/app/PictureInPictureParams;)V
     .locals 8
     .param p1, "r"    # Lcom/android/server/am/ActivityRecord;
     .param p2, "params"    # Landroid/app/PictureInPictureParams;
@@ -73660,6 +73787,30 @@
 .end method
 
 .method public moveActivityTaskToBack(Landroid/os/IBinder;Z)Z
+    .locals 1
+    .param p1, "token"    # Landroid/os/IBinder;
+    .param p2, "nonRoot"    # Z
+
+    .prologue
+    invoke-virtual {p0, p1, p2}, Lcom/android/server/am/ActivityManagerService;->moveActivityTaskToBack$Pr(Landroid/os/IBinder;Z)Z
+
+    move-result v0
+
+    if-eqz v0, :cond_0
+
+    invoke-static {p1}, Lcom/android/server/am/PreventRunningUtils;->onMoveActivityTaskToBack(Landroid/os/IBinder;)V
+
+    const/4 v0, 0x1
+
+    return v0
+
+    :cond_0
+    const/4 v0, 0x0
+
+    return v0
+.end method
+
+.method public moveActivityTaskToBack$Pr(Landroid/os/IBinder;Z)Z
     .locals 5
     .param p1, "token"    # Landroid/os/IBinder;
     .param p2, "nonRoot"    # Z
@@ -89806,6 +89957,31 @@
 .end method
 
 .method public final startActivity(Landroid/app/IApplicationThread;Ljava/lang/String;Landroid/content/Intent;Ljava/lang/String;Landroid/os/IBinder;Ljava/lang/String;IILandroid/app/ProfilerInfo;Landroid/os/Bundle;)I
+    .locals 1
+    .param p1, "caller"    # Landroid/app/IApplicationThread;
+    .param p2, "callingPackage"    # Ljava/lang/String;
+    .param p3, "intent"    # Landroid/content/Intent;
+    .param p4, "resolvedType"    # Ljava/lang/String;
+    .param p5, "resultTo"    # Landroid/os/IBinder;
+    .param p6, "resultWho"    # Ljava/lang/String;
+    .param p7, "requestCode"    # I
+    .param p8, "startFlags"    # I
+    .param p9, "profilerInfo"    # Landroid/app/ProfilerInfo;
+    .param p10, "bOptions"    # Landroid/os/Bundle;
+
+    .prologue
+    invoke-virtual/range {p0 .. p10}, Lcom/android/server/am/ActivityManagerService;->startActivity$Pr(Landroid/app/IApplicationThread;Ljava/lang/String;Landroid/content/Intent;Ljava/lang/String;Landroid/os/IBinder;Ljava/lang/String;IILandroid/app/ProfilerInfo;Landroid/os/Bundle;)I
+
+    move-result v0
+
+    invoke-static {v0, p1, p2, p3}, Lcom/android/server/am/PreventRunningUtils;->onStartActivity(ILandroid/app/IApplicationThread;Ljava/lang/String;Landroid/content/Intent;)I
+
+    move-result v0
+
+    return v0
+.end method
+
+.method public final startActivity$Pr(Landroid/app/IApplicationThread;Ljava/lang/String;Landroid/content/Intent;Ljava/lang/String;Landroid/os/IBinder;Ljava/lang/String;IILandroid/app/ProfilerInfo;Landroid/os/Bundle;)I
     .locals 12
     .param p1, "caller"    # Landroid/app/IApplicationThread;
     .param p2, "callingPackage"    # Ljava/lang/String;
@@ -93234,6 +93410,92 @@
 .end method
 
 .method final startProcessLocked(Ljava/lang/String;Landroid/content/pm/ApplicationInfo;ZILjava/lang/String;Landroid/content/ComponentName;ZZIZLjava/lang/String;Ljava/lang/String;[Ljava/lang/String;Ljava/lang/Runnable;)Lcom/android/server/am/ProcessRecord;
+    .locals 1
+    .param p1, "processName"    # Ljava/lang/String;
+    .param p2, "info"    # Landroid/content/pm/ApplicationInfo;
+    .param p3, "knownToBeDead"    # Z
+    .param p4, "intentFlags"    # I
+    .param p5, "hostingType"    # Ljava/lang/String;
+    .param p6, "hostingName"    # Landroid/content/ComponentName;
+    .param p7, "allowWhileBooting"    # Z
+    .param p8, "isolated"    # Z
+    .param p9, "isolatedUid"    # I
+    .param p10, "keepIfLarge"    # Z
+    .param p11, "abiOverride"    # Ljava/lang/String;
+    .param p12, "entryPoint"    # Ljava/lang/String;
+    .param p13, "entryPointArgs"    # [Ljava/lang/String;
+    .param p14, "crashHandler"    # Ljava/lang/Runnable;
+
+    .prologue
+    invoke-static/range {p1 .. p6}, Lcom/android/server/am/PreventRunningUtils;->hookStartProcessLocked(Ljava/lang/String;Landroid/content/pm/ApplicationInfo;ZILjava/lang/String;Landroid/content/ComponentName;)Z
+
+    move-result v0
+
+    if-eqz v0, :cond_0
+
+    invoke-virtual/range {p0 .. p14}, Lcom/android/server/am/ActivityManagerService;->startProcessLocked$Pr(Ljava/lang/String;Landroid/content/pm/ApplicationInfo;ZILjava/lang/String;Landroid/content/ComponentName;ZZIZLjava/lang/String;Ljava/lang/String;[Ljava/lang/String;Ljava/lang/Runnable;)Lcom/android/server/am/ProcessRecord;
+
+    move-result-object v0
+
+    return-object v0
+
+    :cond_0
+    const/4 v0, 0x0
+
+    return-object v0
+.end method
+
+.method final startProcessLocked(Ljava/lang/String;Landroid/content/pm/ApplicationInfo;ZILjava/lang/String;Landroid/content/ComponentName;ZZZ)Lcom/android/server/am/ProcessRecord;
+    .locals 15
+    .param p1, "processName"    # Ljava/lang/String;
+    .param p2, "info"    # Landroid/content/pm/ApplicationInfo;
+    .param p3, "knownToBeDead"    # Z
+    .param p4, "intentFlags"    # I
+    .param p5, "hostingType"    # Ljava/lang/String;
+    .param p6, "hostingName"    # Landroid/content/ComponentName;
+    .param p7, "allowWhileBooting"    # Z
+    .param p8, "isolated"    # Z
+    .param p9, "keepIfLarge"    # Z
+
+    .prologue
+    const/4 v9, 0x0
+
+    const/4 v11, 0x0
+
+    const/4 v12, 0x0
+
+    const/4 v13, 0x0
+
+    const/4 v14, 0x0
+
+    move-object v0, p0
+
+    move-object/from16 v1, p1
+
+    move-object/from16 v2, p2
+
+    move/from16 v3, p3
+
+    move/from16 v4, p4
+
+    move-object/from16 v5, p5
+
+    move-object/from16 v6, p6
+
+    move/from16 v7, p7
+
+    move/from16 v8, p8
+
+    move/from16 v10, p9
+
+    invoke-virtual/range {v0 .. v14}, Lcom/android/server/am/ActivityManagerService;->startProcessLocked(Ljava/lang/String;Landroid/content/pm/ApplicationInfo;ZILjava/lang/String;Landroid/content/ComponentName;ZZIZLjava/lang/String;Ljava/lang/String;[Ljava/lang/String;Ljava/lang/Runnable;)Lcom/android/server/am/ProcessRecord;
+
+    move-result-object v0
+
+    return-object v0
+.end method
+
+.method final startProcessLocked$Pr(Ljava/lang/String;Landroid/content/pm/ApplicationInfo;ZILjava/lang/String;Landroid/content/ComponentName;ZZIZLjava/lang/String;Ljava/lang/String;[Ljava/lang/String;Ljava/lang/Runnable;)Lcom/android/server/am/ProcessRecord;
     .locals 12
     .param p1, "processName"    # Ljava/lang/String;
     .param p2, "info"    # Landroid/content/pm/ApplicationInfo;
@@ -93592,56 +93854,6 @@
     goto :goto_3
 .end method
 
-.method final startProcessLocked(Ljava/lang/String;Landroid/content/pm/ApplicationInfo;ZILjava/lang/String;Landroid/content/ComponentName;ZZZ)Lcom/android/server/am/ProcessRecord;
-    .locals 15
-    .param p1, "processName"    # Ljava/lang/String;
-    .param p2, "info"    # Landroid/content/pm/ApplicationInfo;
-    .param p3, "knownToBeDead"    # Z
-    .param p4, "intentFlags"    # I
-    .param p5, "hostingType"    # Ljava/lang/String;
-    .param p6, "hostingName"    # Landroid/content/ComponentName;
-    .param p7, "allowWhileBooting"    # Z
-    .param p8, "isolated"    # Z
-    .param p9, "keepIfLarge"    # Z
-
-    .prologue
-    const/4 v9, 0x0
-
-    const/4 v11, 0x0
-
-    const/4 v12, 0x0
-
-    const/4 v13, 0x0
-
-    const/4 v14, 0x0
-
-    move-object v0, p0
-
-    move-object/from16 v1, p1
-
-    move-object/from16 v2, p2
-
-    move/from16 v3, p3
-
-    move/from16 v4, p4
-
-    move-object/from16 v5, p5
-
-    move-object/from16 v6, p6
-
-    move/from16 v7, p7
-
-    move/from16 v8, p8
-
-    move/from16 v10, p9
-
-    invoke-virtual/range {v0 .. v14}, Lcom/android/server/am/ActivityManagerService;->startProcessLocked(Ljava/lang/String;Landroid/content/pm/ApplicationInfo;ZILjava/lang/String;Landroid/content/ComponentName;ZZIZLjava/lang/String;Ljava/lang/String;[Ljava/lang/String;Ljava/lang/Runnable;)Lcom/android/server/am/ProcessRecord;
-
-    move-result-object v0
-
-    return-object v0
-.end method
-
 .method startRunningVoiceLocked(Landroid/service/voice/IVoiceInteractionSession;I)V
     .locals 3
     .param p1, "session"    # Landroid/service/voice/IVoiceInteractionSession;
@@ -93709,6 +93921,55 @@
 .end method
 
 .method public startService(Landroid/app/IApplicationThread;Landroid/content/Intent;Ljava/lang/String;ZLjava/lang/String;I)Landroid/content/ComponentName;
+    .locals 1
+    .param p1, "caller"    # Landroid/app/IApplicationThread;
+    .param p2, "service"    # Landroid/content/Intent;
+    .param p3, "resolvedType"    # Ljava/lang/String;
+    .param p4, "requireForeground"    # Z
+    .param p5, "callingPackage"    # Ljava/lang/String;
+    .param p6, "userId"    # I
+    .annotation system Ldalvik/annotation/Throws;
+        value = {
+            Landroid/os/TransactionTooLargeException;
+        }
+    .end annotation
+
+    .prologue
+    :try_start_0
+    invoke-static {p1}, Lcom/android/server/am/PreventRunningUtils;->setSender(Landroid/app/IApplicationThread;)V
+
+    invoke-static {p1, p2}, Lcom/android/server/am/PreventRunningUtils;->hookStartService(Landroid/app/IApplicationThread;Landroid/content/Intent;)Z
+
+    move-result v0
+
+    if-eqz v0, :cond_0
+
+    invoke-virtual/range {p0 .. p6}, Lcom/android/server/am/ActivityManagerService;->startService$Pr(Landroid/app/IApplicationThread;Landroid/content/Intent;Ljava/lang/String;ZLjava/lang/String;I)Landroid/content/ComponentName;
+    :try_end_0
+    .catchall {:try_start_0 .. :try_end_0} :catchall_0
+
+    move-result-object v0
+
+    invoke-static {}, Lcom/android/server/am/PreventRunningUtils;->clearSender()V
+
+    return-object v0
+
+    :cond_0
+    const/4 v0, 0x0
+
+    invoke-static {}, Lcom/android/server/am/PreventRunningUtils;->clearSender()V
+
+    return-object v0
+
+    :catchall_0
+    move-exception v0
+
+    invoke-static {}, Lcom/android/server/am/PreventRunningUtils;->clearSender()V
+
+    throw v0
+.end method
+
+.method public startService$Pr(Landroid/app/IApplicationThread;Landroid/content/Intent;Ljava/lang/String;ZLjava/lang/String;I)Landroid/content/ComponentName;
     .locals 12
     .param p1, "caller"    # Landroid/app/IApplicationThread;
     .param p2, "service"    # Landroid/content/Intent;
diff --git a/smali/com/android/server/am/ActivityStack.smali b/smali/com/android/server/am/ActivityStack.smali
index ec8e000..549f507 100644
--- a/smali/com/android/server/am/ActivityStack.smali
+++ b/smali/com/android/server/am/ActivityStack.smali
@@ -6560,6 +6560,12 @@
     move-object/from16 v0, v31
 
     invoke-interface {v3, v5, v6, v7, v0}, Landroid/app/IApplicationThread;->scheduleResumeActivity(Landroid/os/IBinder;IZLandroid/os/Bundle;)V
+
+    move-object/from16 v0, v24
+
+    iget-object v3, v0, Lcom/android/server/am/ActivityRecord;->appToken:Landroid/view/IApplicationToken$Stub;
+
+    invoke-static {v3}, Lcom/android/server/am/PreventRunningUtils;->onResumeActivity(Landroid/os/IBinder;)V
     :try_end_3
     .catch Ljava/lang/Exception; {:try_start_3 .. :try_end_3} :catch_1
     .catchall {:try_start_3 .. :try_end_3} :catchall_0
@@ -8715,6 +8721,10 @@
     iget v8, p1, Lcom/android/server/am/ActivityRecord;->configChangeFlags:I
 
     invoke-interface {v5, v6, v7, v8}, Landroid/app/IApplicationThread;->scheduleDestroyActivity(Landroid/os/IBinder;ZI)V
+
+    iget-object v5, p1, Lcom/android/server/am/ActivityRecord;->appToken:Landroid/view/IApplicationToken$Stub;
+
+    invoke-static {v5}, Lcom/android/server/am/PreventRunningUtils;->onDestroyActivity(Landroid/os/IBinder;)V
     :try_end_0
     .catch Ljava/lang/Exception; {:try_start_0 .. :try_end_0} :catch_0
 
@@ -18159,6 +18169,12 @@
     move v5, p4
 
     invoke-interface/range {v0 .. v5}, Landroid/app/IApplicationThread;->schedulePauseActivity(Landroid/os/IBinder;ZZIZ)V
+
+    iget-object v0, v8, Lcom/android/server/am/ActivityRecord;->appToken:Landroid/view/IApplicationToken$Stub;
+
+    iget-boolean v1, v8, Lcom/android/server/am/ActivityRecord;->finishing:Z
+
+    invoke-static {v0, v1, p1}, Lcom/android/server/am/PreventRunningUtils;->onUserLeavingActivity(Landroid/os/IBinder;ZZ)V
     :try_end_0
     .catch Ljava/lang/Exception; {:try_start_0 .. :try_end_0} :catch_0
 
diff --git a/smali/com/android/server/am/ActivityStackSupervisor.smali b/smali/com/android/server/am/ActivityStackSupervisor.smali
index c4e59f3..e76b9f4 100644
--- a/smali/com/android/server/am/ActivityStackSupervisor.smali
+++ b/smali/com/android/server/am/ActivityStackSupervisor.smali
@@ -1111,6 +1111,273 @@
     return v0
 .end method
 
+.method private cleanUpRemovedTaskLocked$Pr(Lcom/android/server/am/TaskRecord;ZZ)V
+    .locals 14
+    .param p1, "tr"    # Lcom/android/server/am/TaskRecord;
+    .param p2, "killProcess"    # Z
+    .param p3, "removeFromRecents"    # Z
+
+    .prologue
+    if-eqz p3, :cond_0
+
+    iget-object v11, p0, Lcom/android/server/am/ActivityStackSupervisor;->mRecentTasks:Lcom/android/server/am/RecentTasks;
+
+    invoke-virtual {v11, p1}, Lcom/android/server/am/RecentTasks;->remove(Ljava/lang/Object;)Z
+
+    invoke-virtual {p1}, Lcom/android/server/am/TaskRecord;->removedFromRecents()V
+
+    :cond_0
+    invoke-virtual {p1}, Lcom/android/server/am/TaskRecord;->getBaseIntent()Landroid/content/Intent;
+
+    move-result-object v11
+
+    invoke-virtual {v11}, Landroid/content/Intent;->getComponent()Landroid/content/ComponentName;
+
+    move-result-object v0
+
+    .local v0, "component":Landroid/content/ComponentName;
+    if-nez v0, :cond_1
+
+    sget-object v11, Lcom/android/server/am/ActivityStackSupervisor;->TAG:Ljava/lang/String;
+
+    new-instance v12, Ljava/lang/StringBuilder;
+
+    invoke-direct {v12}, Ljava/lang/StringBuilder;-><init>()V
+
+    const-string/jumbo v13, "No component for base intent of task: "
+
+    invoke-virtual {v12, v13}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v12
+
+    invoke-virtual {v12, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;
+
+    move-result-object v12
+
+    invoke-virtual {v12}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object v12
+
+    invoke-static {v11, v12}, Landroid/util/Slog;->w(Ljava/lang/String;Ljava/lang/String;)I
+
+    return-void
+
+    :cond_1
+    iget-object v11, p0, Lcom/android/server/am/ActivityStackSupervisor;->mService:Lcom/android/server/am/ActivityManagerService;
+
+    iget-object v11, v11, Lcom/android/server/am/ActivityManagerService;->mServices:Lcom/android/server/am/ActiveServices;
+
+    new-instance v12, Landroid/content/Intent;
+
+    invoke-virtual {p1}, Lcom/android/server/am/TaskRecord;->getBaseIntent()Landroid/content/Intent;
+
+    move-result-object v13
+
+    invoke-direct {v12, v13}, Landroid/content/Intent;-><init>(Landroid/content/Intent;)V
+
+    invoke-virtual {v11, p1, v0, v12}, Lcom/android/server/am/ActiveServices;->cleanUpRemovedTaskLocked(Lcom/android/server/am/TaskRecord;Landroid/content/ComponentName;Landroid/content/Intent;)V
+
+    if-nez p2, :cond_2
+
+    return-void
+
+    :cond_2
+    invoke-virtual {v0}, Landroid/content/ComponentName;->getPackageName()Ljava/lang/String;
+
+    move-result-object v5
+
+    .local v5, "pkg":Ljava/lang/String;
+    new-instance v9, Ljava/util/ArrayList;
+
+    invoke-direct {v9}, Ljava/util/ArrayList;-><init>()V
+
+    .local v9, "procsToKill":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Lcom/android/server/am/ProcessRecord;>;"
+    iget-object v11, p0, Lcom/android/server/am/ActivityStackSupervisor;->mService:Lcom/android/server/am/ActivityManagerService;
+
+    iget-object v11, v11, Lcom/android/server/am/ActivityManagerService;->mProcessNames:Lcom/android/internal/app/ProcessMap;
+
+    invoke-virtual {v11}, Lcom/android/internal/app/ProcessMap;->getMap()Landroid/util/ArrayMap;
+
+    move-result-object v6
+
+    .local v6, "pmap":Landroid/util/ArrayMap;, "Landroid/util/ArrayMap<Ljava/lang/String;Landroid/util/SparseArray<Lcom/android/server/am/ProcessRecord;>;>;"
+    const/4 v1, 0x0
+
+    .local v1, "i":I
+    :goto_0
+    invoke-virtual {v6}, Landroid/util/ArrayMap;->size()I
+
+    move-result v11
+
+    if-ge v1, v11, :cond_9
+
+    invoke-virtual {v6, v1}, Landroid/util/ArrayMap;->valueAt(I)Ljava/lang/Object;
+
+    move-result-object v10
+
+    check-cast v10, Landroid/util/SparseArray;
+
+    .local v10, "uids":Landroid/util/SparseArray;, "Landroid/util/SparseArray<Lcom/android/server/am/ProcessRecord;>;"
+    const/4 v2, 0x0
+
+    .local v2, "j":I
+    :goto_1
+    invoke-virtual {v10}, Landroid/util/SparseArray;->size()I
+
+    move-result v11
+
+    if-ge v2, v11, :cond_8
+
+    invoke-virtual {v10, v2}, Landroid/util/SparseArray;->valueAt(I)Ljava/lang/Object;
+
+    move-result-object v8
+
+    check-cast v8, Lcom/android/server/am/ProcessRecord;
+
+    .local v8, "proc":Lcom/android/server/am/ProcessRecord;
+    iget v11, v8, Lcom/android/server/am/ProcessRecord;->userId:I
+
+    iget v12, p1, Lcom/android/server/am/TaskRecord;->userId:I
+
+    if-eq v11, v12, :cond_4
+
+    :cond_3
+    :goto_2
+    add-int/lit8 v2, v2, 0x1
+
+    goto :goto_1
+
+    :cond_4
+    iget-object v11, p0, Lcom/android/server/am/ActivityStackSupervisor;->mService:Lcom/android/server/am/ActivityManagerService;
+
+    iget-object v11, v11, Lcom/android/server/am/ActivityManagerService;->mHomeProcess:Lcom/android/server/am/ProcessRecord;
+
+    if-eq v8, v11, :cond_3
+
+    iget-object v11, v8, Lcom/android/server/am/ProcessRecord;->pkgList:Landroid/util/ArrayMap;
+
+    invoke-virtual {v11, v5}, Landroid/util/ArrayMap;->containsKey(Ljava/lang/Object;)Z
+
+    move-result v11
+
+    if-eqz v11, :cond_3
+
+    const/4 v3, 0x0
+
+    .local v3, "k":I
+    :goto_3
+    iget-object v11, v8, Lcom/android/server/am/ProcessRecord;->activities:Ljava/util/ArrayList;
+
+    invoke-virtual {v11}, Ljava/util/ArrayList;->size()I
+
+    move-result v11
+
+    if-ge v3, v11, :cond_6
+
+    iget-object v11, v8, Lcom/android/server/am/ProcessRecord;->activities:Ljava/util/ArrayList;
+
+    invoke-virtual {v11, v3}, Ljava/util/ArrayList;->get(I)Ljava/lang/Object;
+
+    move-result-object v11
+
+    check-cast v11, Lcom/android/server/am/ActivityRecord;
+
+    invoke-virtual {v11}, Lcom/android/server/am/ActivityRecord;->getTask()Lcom/android/server/am/TaskRecord;
+
+    move-result-object v4
+
+    .local v4, "otherTask":Lcom/android/server/am/TaskRecord;
+    iget v11, p1, Lcom/android/server/am/TaskRecord;->taskId:I
+
+    iget v12, v4, Lcom/android/server/am/TaskRecord;->taskId:I
+
+    if-eq v11, v12, :cond_5
+
+    iget-boolean v11, v4, Lcom/android/server/am/TaskRecord;->inRecents:Z
+
+    if-eqz v11, :cond_5
+
+    return-void
+
+    :cond_5
+    add-int/lit8 v3, v3, 0x1
+
+    goto :goto_3
+
+    .end local v4    # "otherTask":Lcom/android/server/am/TaskRecord;
+    :cond_6
+    iget-boolean v11, v8, Lcom/android/server/am/ProcessRecord;->foregroundServices:Z
+
+    if-eqz v11, :cond_7
+
+    return-void
+
+    :cond_7
+    invoke-virtual {v9, v8}, Ljava/util/ArrayList;->add(Ljava/lang/Object;)Z
+
+    goto :goto_2
+
+    .end local v3    # "k":I
+    .end local v8    # "proc":Lcom/android/server/am/ProcessRecord;
+    :cond_8
+    add-int/lit8 v1, v1, 0x1
+
+    goto :goto_0
+
+    .end local v2    # "j":I
+    .end local v10    # "uids":Landroid/util/SparseArray;, "Landroid/util/SparseArray<Lcom/android/server/am/ProcessRecord;>;"
+    :cond_9
+    const/4 v1, 0x0
+
+    :goto_4
+    invoke-virtual {v9}, Ljava/util/ArrayList;->size()I
+
+    move-result v11
+
+    if-ge v1, v11, :cond_b
+
+    invoke-virtual {v9, v1}, Ljava/util/ArrayList;->get(I)Ljava/lang/Object;
+
+    move-result-object v7
+
+    check-cast v7, Lcom/android/server/am/ProcessRecord;
+
+    .local v7, "pr":Lcom/android/server/am/ProcessRecord;
+    iget v11, v7, Lcom/android/server/am/ProcessRecord;->setSchedGroup:I
+
+    if-nez v11, :cond_a
+
+    iget-object v11, v7, Lcom/android/server/am/ProcessRecord;->curReceivers:Landroid/util/ArraySet;
+
+    invoke-virtual {v11}, Landroid/util/ArraySet;->isEmpty()Z
+
+    move-result v11
+
+    if-eqz v11, :cond_a
+
+    const-string/jumbo v11, "remove task"
+
+    const/4 v12, 0x1
+
+    invoke-virtual {v7, v11, v12}, Lcom/android/server/am/ProcessRecord;->kill(Ljava/lang/String;Z)V
+
+    :goto_5
+    add-int/lit8 v1, v1, 0x1
+
+    goto :goto_4
+
+    :cond_a
+    const-string/jumbo v11, "remove task"
+
+    iput-object v11, v7, Lcom/android/server/am/ProcessRecord;->waitingToKill:Ljava/lang/String;
+
+    goto :goto_5
+
+    .end local v7    # "pr":Lcom/android/server/am/ProcessRecord;
+    :cond_b
+    return-void
+.end method
+
 .method private displayConfigMatchesGlobal(I)Z
     .locals 4
     .param p1, "displayId"    # I
@@ -6000,455 +6267,226 @@
 
     move-result-object v5
 
-    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
-
-    move-result-object v4
-
-    const-string/jumbo v5, " from "
-
-    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
-
-    move-result-object v4
-
-    move-object/from16 v0, p9
-
-    invoke-virtual {v4, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;
-
-    move-result-object v4
-
-    const-string/jumbo v5, " (pid="
-
-    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
-
-    move-result-object v4
-
-    move/from16 v0, p5
-
-    invoke-virtual {v4, v0}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
-
-    move-result-object v4
-
-    const-string/jumbo v5, ", uid="
-
-    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
-
-    move-result-object v4
-
-    move/from16 v0, p6
-
-    invoke-virtual {v4, v0}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
-
-    move-result-object v4
-
-    const-string/jumbo v5, ") with launchTaskId="
-
-    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
-
-    move-result-object v4
-
-    invoke-virtual/range {p12 .. p12}, Landroid/app/ActivityOptions;->getLaunchTaskId()I
-
-    move-result v5
-
-    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
-
-    move-result-object v4
-
-    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
-
-    move-result-object v15
-
-    .restart local v15    # "msg":Ljava/lang/String;
-    sget-object v4, Lcom/android/server/am/ActivityStackSupervisor;->TAG:Ljava/lang/String;
-
-    invoke-static {v4, v15}, Landroid/util/Slog;->w(Ljava/lang/String;Ljava/lang/String;)I
-
-    new-instance v4, Ljava/lang/SecurityException;
-
-    invoke-direct {v4, v15}, Ljava/lang/SecurityException;-><init>(Ljava/lang/String;)V
-
-    throw v4
-
-    .end local v15    # "msg":Ljava/lang/String;
-    .end local v17    # "startInTaskPerm":I
-    :cond_8
-    invoke-virtual/range {p12 .. p12}, Landroid/app/ActivityOptions;->getLaunchDisplayId()I
-
-    move-result v13
-
-    .local v13, "launchDisplayId":I
-    const/4 v4, -0x1
-
-    if-eq v13, v4, :cond_9
-
-    move-object/from16 v0, p0
-
-    move/from16 v1, p5
-
-    move/from16 v2, p6
-
-    move-object/from16 v3, p2
-
-    invoke-virtual {v0, v1, v2, v13, v3}, Lcom/android/server/am/ActivityStackSupervisor;->isCallerAllowedToLaunchOnDisplay(IIILandroid/content/pm/ActivityInfo;)Z
-
-    move-result v4
-
-    xor-int/lit8 v4, v4, 0x1
-
-    if-eqz v4, :cond_9
-
-    new-instance v4, Ljava/lang/StringBuilder;
-
-    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V
-
-    const-string/jumbo v5, "Permission Denial: starting "
-
-    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
-
-    move-result-object v4
-
-    invoke-virtual/range {p1 .. p1}, Landroid/content/Intent;->toString()Ljava/lang/String;
-
-    move-result-object v5
-
-    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
-
-    move-result-object v4
-
-    const-string/jumbo v5, " from "
-
-    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
-
-    move-result-object v4
-
-    move-object/from16 v0, p9
-
-    invoke-virtual {v4, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;
-
-    move-result-object v4
-
-    const-string/jumbo v5, " (pid="
-
-    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
-
-    move-result-object v4
-
-    move/from16 v0, p5
-
-    invoke-virtual {v4, v0}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
-
-    move-result-object v4
-
-    const-string/jumbo v5, ", uid="
-
-    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
-
-    move-result-object v4
-
-    move/from16 v0, p6
-
-    invoke-virtual {v4, v0}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
-
-    move-result-object v4
-
-    const-string/jumbo v5, ") with launchDisplayId="
-
-    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
-
-    move-result-object v4
-
-    invoke-virtual {v4, v13}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
-
-    move-result-object v4
-
-    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
-
-    move-result-object v15
-
-    .restart local v15    # "msg":Ljava/lang/String;
-    sget-object v4, Lcom/android/server/am/ActivityStackSupervisor;->TAG:Ljava/lang/String;
-
-    invoke-static {v4, v15}, Landroid/util/Slog;->w(Ljava/lang/String;Ljava/lang/String;)I
-
-    new-instance v4, Ljava/lang/SecurityException;
-
-    invoke-direct {v4, v15}, Ljava/lang/SecurityException;-><init>(Ljava/lang/String;)V
-
-    throw v4
-
-    .end local v13    # "launchDisplayId":I
-    .end local v15    # "msg":Ljava/lang/String;
-    :cond_9
-    const/4 v4, 0x1
-
-    return v4
-.end method
-
-.method cleanUpRemovedTaskLocked(Lcom/android/server/am/TaskRecord;ZZ)V
-    .locals 14
-    .param p1, "tr"    # Lcom/android/server/am/TaskRecord;
-    .param p2, "killProcess"    # Z
-    .param p3, "removeFromRecents"    # Z
-
-    .prologue
-    if-eqz p3, :cond_0
-
-    iget-object v11, p0, Lcom/android/server/am/ActivityStackSupervisor;->mRecentTasks:Lcom/android/server/am/RecentTasks;
-
-    invoke-virtual {v11, p1}, Lcom/android/server/am/RecentTasks;->remove(Ljava/lang/Object;)Z
-
-    invoke-virtual {p1}, Lcom/android/server/am/TaskRecord;->removedFromRecents()V
-
-    :cond_0
-    invoke-virtual {p1}, Lcom/android/server/am/TaskRecord;->getBaseIntent()Landroid/content/Intent;
-
-    move-result-object v11
-
-    invoke-virtual {v11}, Landroid/content/Intent;->getComponent()Landroid/content/ComponentName;
-
-    move-result-object v0
-
-    .local v0, "component":Landroid/content/ComponentName;
-    if-nez v0, :cond_1
-
-    sget-object v11, Lcom/android/server/am/ActivityStackSupervisor;->TAG:Ljava/lang/String;
-
-    new-instance v12, Ljava/lang/StringBuilder;
-
-    invoke-direct {v12}, Ljava/lang/StringBuilder;-><init>()V
+    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
-    const-string/jumbo v13, "No component for base intent of task: "
+    move-result-object v4
 
-    invoke-virtual {v12, v13}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+    const-string/jumbo v5, " from "
 
-    move-result-object v12
+    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
-    invoke-virtual {v12, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;
+    move-result-object v4
 
-    move-result-object v12
+    move-object/from16 v0, p9
 
-    invoke-virtual {v12}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+    invoke-virtual {v4, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;
 
-    move-result-object v12
+    move-result-object v4
 
-    invoke-static {v11, v12}, Landroid/util/Slog;->w(Ljava/lang/String;Ljava/lang/String;)I
+    const-string/jumbo v5, " (pid="
 
-    return-void
+    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
-    :cond_1
-    iget-object v11, p0, Lcom/android/server/am/ActivityStackSupervisor;->mService:Lcom/android/server/am/ActivityManagerService;
+    move-result-object v4
 
-    iget-object v11, v11, Lcom/android/server/am/ActivityManagerService;->mServices:Lcom/android/server/am/ActiveServices;
+    move/from16 v0, p5
 
-    new-instance v12, Landroid/content/Intent;
+    invoke-virtual {v4, v0}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
 
-    invoke-virtual {p1}, Lcom/android/server/am/TaskRecord;->getBaseIntent()Landroid/content/Intent;
+    move-result-object v4
 
-    move-result-object v13
+    const-string/jumbo v5, ", uid="
 
-    invoke-direct {v12, v13}, Landroid/content/Intent;-><init>(Landroid/content/Intent;)V
+    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
-    invoke-virtual {v11, p1, v0, v12}, Lcom/android/server/am/ActiveServices;->cleanUpRemovedTaskLocked(Lcom/android/server/am/TaskRecord;Landroid/content/ComponentName;Landroid/content/Intent;)V
+    move-result-object v4
 
-    if-nez p2, :cond_2
+    move/from16 v0, p6
 
-    return-void
+    invoke-virtual {v4, v0}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
 
-    :cond_2
-    invoke-virtual {v0}, Landroid/content/ComponentName;->getPackageName()Ljava/lang/String;
+    move-result-object v4
 
-    move-result-object v5
+    const-string/jumbo v5, ") with launchTaskId="
 
-    .local v5, "pkg":Ljava/lang/String;
-    new-instance v9, Ljava/util/ArrayList;
+    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
-    invoke-direct {v9}, Ljava/util/ArrayList;-><init>()V
+    move-result-object v4
 
-    .local v9, "procsToKill":Ljava/util/ArrayList;, "Ljava/util/ArrayList<Lcom/android/server/am/ProcessRecord;>;"
-    iget-object v11, p0, Lcom/android/server/am/ActivityStackSupervisor;->mService:Lcom/android/server/am/ActivityManagerService;
+    invoke-virtual/range {p12 .. p12}, Landroid/app/ActivityOptions;->getLaunchTaskId()I
 
-    iget-object v11, v11, Lcom/android/server/am/ActivityManagerService;->mProcessNames:Lcom/android/internal/app/ProcessMap;
+    move-result v5
 
-    invoke-virtual {v11}, Lcom/android/internal/app/ProcessMap;->getMap()Landroid/util/ArrayMap;
+    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
 
-    move-result-object v6
+    move-result-object v4
 
-    .local v6, "pmap":Landroid/util/ArrayMap;, "Landroid/util/ArrayMap<Ljava/lang/String;Landroid/util/SparseArray<Lcom/android/server/am/ProcessRecord;>;>;"
-    const/4 v1, 0x0
+    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
 
-    .local v1, "i":I
-    :goto_0
-    invoke-virtual {v6}, Landroid/util/ArrayMap;->size()I
+    move-result-object v15
 
-    move-result v11
+    .restart local v15    # "msg":Ljava/lang/String;
+    sget-object v4, Lcom/android/server/am/ActivityStackSupervisor;->TAG:Ljava/lang/String;
 
-    if-ge v1, v11, :cond_9
+    invoke-static {v4, v15}, Landroid/util/Slog;->w(Ljava/lang/String;Ljava/lang/String;)I
 
-    invoke-virtual {v6, v1}, Landroid/util/ArrayMap;->valueAt(I)Ljava/lang/Object;
+    new-instance v4, Ljava/lang/SecurityException;
 
-    move-result-object v10
+    invoke-direct {v4, v15}, Ljava/lang/SecurityException;-><init>(Ljava/lang/String;)V
 
-    check-cast v10, Landroid/util/SparseArray;
+    throw v4
 
-    .local v10, "uids":Landroid/util/SparseArray;, "Landroid/util/SparseArray<Lcom/android/server/am/ProcessRecord;>;"
-    const/4 v2, 0x0
+    .end local v15    # "msg":Ljava/lang/String;
+    .end local v17    # "startInTaskPerm":I
+    :cond_8
+    invoke-virtual/range {p12 .. p12}, Landroid/app/ActivityOptions;->getLaunchDisplayId()I
 
-    .local v2, "j":I
-    :goto_1
-    invoke-virtual {v10}, Landroid/util/SparseArray;->size()I
+    move-result v13
 
-    move-result v11
+    .local v13, "launchDisplayId":I
+    const/4 v4, -0x1
 
-    if-ge v2, v11, :cond_8
+    if-eq v13, v4, :cond_9
 
-    invoke-virtual {v10, v2}, Landroid/util/SparseArray;->valueAt(I)Ljava/lang/Object;
+    move-object/from16 v0, p0
 
-    move-result-object v8
+    move/from16 v1, p5
 
-    check-cast v8, Lcom/android/server/am/ProcessRecord;
+    move/from16 v2, p6
 
-    .local v8, "proc":Lcom/android/server/am/ProcessRecord;
-    iget v11, v8, Lcom/android/server/am/ProcessRecord;->userId:I
+    move-object/from16 v3, p2
 
-    iget v12, p1, Lcom/android/server/am/TaskRecord;->userId:I
+    invoke-virtual {v0, v1, v2, v13, v3}, Lcom/android/server/am/ActivityStackSupervisor;->isCallerAllowedToLaunchOnDisplay(IIILandroid/content/pm/ActivityInfo;)Z
 
-    if-eq v11, v12, :cond_4
+    move-result v4
 
-    :cond_3
-    :goto_2
-    add-int/lit8 v2, v2, 0x1
+    xor-int/lit8 v4, v4, 0x1
 
-    goto :goto_1
+    if-eqz v4, :cond_9
 
-    :cond_4
-    iget-object v11, p0, Lcom/android/server/am/ActivityStackSupervisor;->mService:Lcom/android/server/am/ActivityManagerService;
+    new-instance v4, Ljava/lang/StringBuilder;
 
-    iget-object v11, v11, Lcom/android/server/am/ActivityManagerService;->mHomeProcess:Lcom/android/server/am/ProcessRecord;
+    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V
 
-    if-eq v8, v11, :cond_3
+    const-string/jumbo v5, "Permission Denial: starting "
 
-    iget-object v11, v8, Lcom/android/server/am/ProcessRecord;->pkgList:Landroid/util/ArrayMap;
+    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
-    invoke-virtual {v11, v5}, Landroid/util/ArrayMap;->containsKey(Ljava/lang/Object;)Z
+    move-result-object v4
 
-    move-result v11
+    invoke-virtual/range {p1 .. p1}, Landroid/content/Intent;->toString()Ljava/lang/String;
 
-    if-eqz v11, :cond_3
+    move-result-object v5
 
-    const/4 v3, 0x0
+    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
-    .local v3, "k":I
-    :goto_3
-    iget-object v11, v8, Lcom/android/server/am/ProcessRecord;->activities:Ljava/util/ArrayList;
+    move-result-object v4
 
-    invoke-virtual {v11}, Ljava/util/ArrayList;->size()I
+    const-string/jumbo v5, " from "
 
-    move-result v11
+    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
-    if-ge v3, v11, :cond_6
+    move-result-object v4
 
-    iget-object v11, v8, Lcom/android/server/am/ProcessRecord;->activities:Ljava/util/ArrayList;
+    move-object/from16 v0, p9
 
-    invoke-virtual {v11, v3}, Ljava/util/ArrayList;->get(I)Ljava/lang/Object;
+    invoke-virtual {v4, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;
 
-    move-result-object v11
+    move-result-object v4
 
-    check-cast v11, Lcom/android/server/am/ActivityRecord;
+    const-string/jumbo v5, " (pid="
 
-    invoke-virtual {v11}, Lcom/android/server/am/ActivityRecord;->getTask()Lcom/android/server/am/TaskRecord;
+    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
     move-result-object v4
 
-    .local v4, "otherTask":Lcom/android/server/am/TaskRecord;
-    iget v11, p1, Lcom/android/server/am/TaskRecord;->taskId:I
-
-    iget v12, v4, Lcom/android/server/am/TaskRecord;->taskId:I
+    move/from16 v0, p5
 
-    if-eq v11, v12, :cond_5
+    invoke-virtual {v4, v0}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
 
-    iget-boolean v11, v4, Lcom/android/server/am/TaskRecord;->inRecents:Z
+    move-result-object v4
 
-    if-eqz v11, :cond_5
+    const-string/jumbo v5, ", uid="
 
-    return-void
+    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
-    :cond_5
-    add-int/lit8 v3, v3, 0x1
+    move-result-object v4
 
-    goto :goto_3
+    move/from16 v0, p6
 
-    .end local v4    # "otherTask":Lcom/android/server/am/TaskRecord;
-    :cond_6
-    iget-boolean v11, v8, Lcom/android/server/am/ProcessRecord;->foregroundServices:Z
+    invoke-virtual {v4, v0}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
 
-    if-eqz v11, :cond_7
+    move-result-object v4
 
-    return-void
+    const-string/jumbo v5, ") with launchDisplayId="
 
-    :cond_7
-    invoke-virtual {v9, v8}, Ljava/util/ArrayList;->add(Ljava/lang/Object;)Z
+    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
-    goto :goto_2
+    move-result-object v4
 
-    .end local v3    # "k":I
-    .end local v8    # "proc":Lcom/android/server/am/ProcessRecord;
-    :cond_8
-    add-int/lit8 v1, v1, 0x1
+    invoke-virtual {v4, v13}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
 
-    goto :goto_0
+    move-result-object v4
 
-    .end local v2    # "j":I
-    .end local v10    # "uids":Landroid/util/SparseArray;, "Landroid/util/SparseArray<Lcom/android/server/am/ProcessRecord;>;"
-    :cond_9
-    const/4 v1, 0x0
+    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
 
-    :goto_4
-    invoke-virtual {v9}, Ljava/util/ArrayList;->size()I
+    move-result-object v15
 
-    move-result v11
+    .restart local v15    # "msg":Ljava/lang/String;
+    sget-object v4, Lcom/android/server/am/ActivityStackSupervisor;->TAG:Ljava/lang/String;
 
-    if-ge v1, v11, :cond_b
+    invoke-static {v4, v15}, Landroid/util/Slog;->w(Ljava/lang/String;Ljava/lang/String;)I
 
-    invoke-virtual {v9, v1}, Ljava/util/ArrayList;->get(I)Ljava/lang/Object;
+    new-instance v4, Ljava/lang/SecurityException;
 
-    move-result-object v7
+    invoke-direct {v4, v15}, Ljava/lang/SecurityException;-><init>(Ljava/lang/String;)V
 
-    check-cast v7, Lcom/android/server/am/ProcessRecord;
+    throw v4
 
-    .local v7, "pr":Lcom/android/server/am/ProcessRecord;
-    iget v11, v7, Lcom/android/server/am/ProcessRecord;->setSchedGroup:I
+    .end local v13    # "launchDisplayId":I
+    .end local v15    # "msg":Ljava/lang/String;
+    :cond_9
+    const/4 v4, 0x1
 
-    if-nez v11, :cond_a
+    return v4
+.end method
 
-    iget-object v11, v7, Lcom/android/server/am/ProcessRecord;->curReceivers:Landroid/util/ArraySet;
+.method cleanUpRemovedTaskLocked(Lcom/android/server/am/TaskRecord;ZZ)V
+    .locals 2
+    .param p1, "tr"    # Lcom/android/server/am/TaskRecord;
+    .param p2, "killProcess"    # Z
+    .param p3, "removeFromRecents"    # Z
 
-    invoke-virtual {v11}, Landroid/util/ArraySet;->isEmpty()Z
+    .prologue
+    :try_start_0
+    invoke-direct {p0, p1, p2, p3}, Lcom/android/server/am/ActivityStackSupervisor;->cleanUpRemovedTaskLocked$Pr(Lcom/android/server/am/TaskRecord;ZZ)V
+    :try_end_0
+    .catchall {:try_start_0 .. :try_end_0} :catchall_0
 
-    move-result v11
+    if-eqz p2, :cond_0
 
-    if-eqz v11, :cond_a
+    invoke-virtual {p1}, Lcom/android/server/am/TaskRecord;->getBaseIntent()Landroid/content/Intent;
 
-    const-string/jumbo v11, "remove task"
+    move-result-object v0
 
-    const/4 v12, 0x1
+    invoke-static {v0}, Lcom/android/server/am/PreventRunningUtils;->onCleanUpRemovedTask(Landroid/content/Intent;)V
 
-    invoke-virtual {v7, v11, v12}, Lcom/android/server/am/ProcessRecord;->kill(Ljava/lang/String;Z)V
+    :cond_0
+    return-void
 
-    :goto_5
-    add-int/lit8 v1, v1, 0x1
+    :catchall_0
+    move-exception v0
 
-    goto :goto_4
+    if-eqz p2, :cond_1
 
-    :cond_a
-    const-string/jumbo v11, "remove task"
+    invoke-virtual {p1}, Lcom/android/server/am/TaskRecord;->getBaseIntent()Landroid/content/Intent;
 
-    iput-object v11, v7, Lcom/android/server/am/ProcessRecord;->waitingToKill:Ljava/lang/String;
+    move-result-object v1
 
-    goto :goto_5
+    invoke-static {v1}, Lcom/android/server/am/PreventRunningUtils;->onCleanUpRemovedTask(Landroid/content/Intent;)V
 
-    .end local v7    # "pr":Lcom/android/server/am/ProcessRecord;
-    :cond_b
-    return-void
+    :cond_1
+    throw v0
 .end method
 
 .method cleanupActivity(Lcom/android/server/am/ActivityRecord;)V
@@ -10999,7 +11037,7 @@
     return v2
 .end method
 
-.method synthetic lambda$-com_android_server_am_ActivityStackSupervisor_113947(IZ)V
+.method synthetic lambda$-com_android_server_am_ActivityStackSupervisor_114013(IZ)V
     .locals 0
     .param p1, "fromStackId"    # I
     .param p2, "onTop"    # Z
@@ -11010,7 +11048,7 @@
     return-void
 .end method
 
-.method synthetic lambda$-com_android_server_am_ActivityStackSupervisor_122545(I)V
+.method synthetic lambda$-com_android_server_am_ActivityStackSupervisor_122611(I)V
     .locals 0
     .param p1, "stackId"    # I
 
@@ -13392,6 +13430,12 @@
 
     invoke-interface/range {v4 .. v21}, Landroid/app/IApplicationThread;->scheduleLaunchActivity(Landroid/content/Intent;Landroid/os/IBinder;ILandroid/content/pm/ActivityInfo;Landroid/content/res/Configuration;Landroid/content/res/Configuration;Landroid/content/res/CompatibilityInfo;Ljava/lang/String;Lcom/android/internal/app/IVoiceInteractor;ILandroid/os/Bundle;Landroid/os/PersistableBundle;Ljava/util/List;Ljava/util/List;ZZLandroid/app/ProfilerInfo;)V
 
+    move-object/from16 v0, p1
+
+    iget-object v4, v0, Lcom/android/server/am/ActivityRecord;->appToken:Landroid/view/IApplicationToken$Stub;
+
+    invoke-static {v4}, Lcom/android/server/am/PreventRunningUtils;->onLaunchActivity(Landroid/os/IBinder;)V
+
     move-object/from16 v0, p2
 
     iget-object v4, v0, Lcom/android/server/am/ProcessRecord;->info:Landroid/content/pm/ApplicationInfo;
diff --git a/smali/com/android/server/am/PreventRunning.smali b/smali/com/android/server/am/PreventRunning.smali
new file mode 100644
index 0000000..c16e2b7
--- /dev/null
+++ b/smali/com/android/server/am/PreventRunning.smali
@@ -0,0 +1,656 @@
+.class public Lcom/android/server/am/PreventRunning;
+.super Ljava/lang/Object;
+.source "PreventRunning.java"
+
+# interfaces
+.implements Lcom/android/server/am/PreventRunningHook;
+
+
+# static fields
+.field private static APKS:[Ljava/lang/String; = null
+
+.field private static final TAG:Ljava/lang/String; = "Prevent"
+
+.field public static final VERSION:I = 0x133a200
+
+
+# instance fields
+.field private mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+
+# direct methods
+.method static constructor <clinit>()V
+    .locals 3
+
+    .prologue
+    const/4 v0, 0x7
+
+    new-array v0, v0, [Ljava/lang/String;
+
+    const-string/jumbo v1, "/system/app/Brevent/Brevent.apk"
+
+    const/4 v2, 0x0
+
+    aput-object v1, v0, v2
+
+    const-string/jumbo v1, "/data/app/me.piebridge.prevent-1/base.apk"
+
+    const/4 v2, 0x1
+
+    aput-object v1, v0, v2
+
+    const-string/jumbo v1, "/data/app/me.piebridge.prevent-2/base.apk"
+
+    const/4 v2, 0x2
+
+    aput-object v1, v0, v2
+
+    const-string/jumbo v1, "/data/app/me.piebridge.prevent-3/base.apk"
+
+    const/4 v2, 0x3
+
+    aput-object v1, v0, v2
+
+    const-string/jumbo v1, "/data/app/me.piebridge.prevent-1.apk"
+
+    const/4 v2, 0x4
+
+    aput-object v1, v0, v2
+
+    const-string/jumbo v1, "/data/app/me.piebridge.prevent-2.apk"
+
+    const/4 v2, 0x5
+
+    aput-object v1, v0, v2
+
+    const-string/jumbo v1, "/data/app/me.piebridge.prevent-3.apk"
+
+    const/4 v2, 0x6
+
+    aput-object v1, v0, v2
+
+    sput-object v0, Lcom/android/server/am/PreventRunning;->APKS:[Ljava/lang/String;
+
+    return-void
+.end method
+
+.method public constructor <init>()V
+    .locals 6
+
+    .prologue
+    invoke-direct {p0}, Ljava/lang/Object;-><init>()V
+
+    sget-object v3, Lcom/android/server/am/PreventRunning;->APKS:[Ljava/lang/String;
+
+    const/4 v2, 0x0
+
+    array-length v4, v3
+
+    :goto_0
+    if-ge v2, v4, :cond_0
+
+    aget-object v0, v3, v2
+
+    .local v0, "apk":Ljava/lang/String;
+    new-instance v1, Ljava/io/File;
+
+    invoke-direct {v1, v0}, Ljava/io/File;-><init>(Ljava/lang/String;)V
+
+    .local v1, "file":Ljava/io/File;
+    invoke-virtual {v1}, Ljava/io/File;->exists()Z
+
+    move-result v5
+
+    if-eqz v5, :cond_1
+
+    invoke-direct {p0, v1}, Lcom/android/server/am/PreventRunning;->initPreventRunning(Ljava/io/File;)Z
+
+    move-result v5
+
+    if-eqz v5, :cond_1
+
+    .end local v0    # "apk":Ljava/lang/String;
+    .end local v1    # "file":Ljava/io/File;
+    :cond_0
+    return-void
+
+    .restart local v0    # "apk":Ljava/lang/String;
+    .restart local v1    # "file":Ljava/io/File;
+    :cond_1
+    add-int/lit8 v2, v2, 0x1
+
+    goto :goto_0
+.end method
+
+.method private initPreventRunning(Ljava/io/File;)Z
+    .locals 9
+    .param p1, "apk"    # Ljava/io/File;
+
+    .prologue
+    :try_start_0
+    invoke-static {}, Ljava/lang/Thread;->currentThread()Ljava/lang/Thread;
+
+    move-result-object v6
+
+    invoke-virtual {v6}, Ljava/lang/Thread;->getContextClassLoader()Ljava/lang/ClassLoader;
+
+    move-result-object v1
+
+    .local v1, "currentClassLoader":Ljava/lang/ClassLoader;
+    new-instance v0, Ldalvik/system/DexClassLoader;
+
+    invoke-virtual {p1}, Ljava/io/File;->getAbsolutePath()Ljava/lang/String;
+
+    move-result-object v6
+
+    const-string/jumbo v7, "/cache"
+
+    const/4 v8, 0x0
+
+    invoke-direct {v0, v6, v7, v8, v1}, Ldalvik/system/DexClassLoader;-><init>(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/ClassLoader;)V
+
+    .local v0, "classLoader":Ljava/lang/ClassLoader;
+    const-string/jumbo v6, "Prevent"
+
+    new-instance v7, Ljava/lang/StringBuilder;
+
+    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V
+
+    const-string/jumbo v8, "loading PreventRunning(20161024) from "
+
+    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v7
+
+    invoke-virtual {v7, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;
+
+    move-result-object v7
+
+    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object v7
+
+    invoke-static {v6, v7}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
+
+    const-string/jumbo v6, "me.piebridge.prevent.framework.PreventRunning"
+
+    invoke-virtual {v0, v6}, Ljava/lang/ClassLoader;->loadClass(Ljava/lang/String;)Ljava/lang/Class;
+
+    move-result-object v6
+
+    invoke-virtual {v6}, Ljava/lang/Class;->newInstance()Ljava/lang/Object;
+
+    move-result-object v6
+
+    check-cast v6, Lcom/android/server/am/PreventRunningHook;
+
+    iput-object v6, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    const v6, 0x133a200
+
+    invoke-virtual {p0, v6}, Lcom/android/server/am/PreventRunning;->setVersion(I)V
+
+    const-string/jumbo v6, "native"
+
+    invoke-virtual {p0, v6}, Lcom/android/server/am/PreventRunning;->setMethod(Ljava/lang/String;)V
+    :try_end_0
+    .catch Ljava/lang/ClassNotFoundException; {:try_start_0 .. :try_end_0} :catch_3
+    .catch Ljava/lang/InstantiationException; {:try_start_0 .. :try_end_0} :catch_2
+    .catch Ljava/lang/IllegalAccessException; {:try_start_0 .. :try_end_0} :catch_1
+    .catch Ljava/lang/Throwable; {:try_start_0 .. :try_end_0} :catch_0
+
+    const/4 v6, 0x1
+
+    return v6
+
+    .end local v0    # "classLoader":Ljava/lang/ClassLoader;
+    .end local v1    # "currentClassLoader":Ljava/lang/ClassLoader;
+    :catch_0
+    move-exception v5
+
+    .local v5, "t":Ljava/lang/Throwable;
+    const-string/jumbo v6, "Prevent"
+
+    new-instance v7, Ljava/lang/StringBuilder;
+
+    invoke-direct {v7}, Ljava/lang/StringBuilder;-><init>()V
+
+    const-string/jumbo v8, "cannot load PreventRunning from "
+
+    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v7
+
+    invoke-virtual {v7, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;
+
+    move-result-object v7
+
+    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object v7
+
+    invoke-static {v6, v7, v5}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;Ljava/lang/Throwable;)I
+
+    .end local v5    # "t":Ljava/lang/Throwable;
+    :goto_0
+    const/4 v6, 0x0
+
+    return v6
+
+    :catch_1
+    move-exception v3
+
+    .local v3, "e":Ljava/lang/IllegalAccessException;
+    const-string/jumbo v6, "Prevent"
+
+    const-string/jumbo v7, "cannot access class"
+
+    invoke-static {v6, v7, v3}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;Ljava/lang/Throwable;)I
+
+    goto :goto_0
+
+    .end local v3    # "e":Ljava/lang/IllegalAccessException;
+    :catch_2
+    move-exception v4
+
+    .local v4, "e":Ljava/lang/InstantiationException;
+    const-string/jumbo v6, "Prevent"
+
+    const-string/jumbo v7, "cannot instance class"
+
+    invoke-static {v6, v7, v4}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;Ljava/lang/Throwable;)I
+
+    goto :goto_0
+
+    .end local v4    # "e":Ljava/lang/InstantiationException;
+    :catch_3
+    move-exception v2
+
+    .local v2, "e":Ljava/lang/ClassNotFoundException;
+    const-string/jumbo v6, "Prevent"
+
+    const-string/jumbo v7, "cannot find class"
+
+    invoke-static {v6, v7, v2}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;Ljava/lang/Throwable;)I
+
+    goto :goto_0
+.end method
+
+
+# virtual methods
+.method public hookBindService(Landroid/content/Intent;)Z
+    .locals 1
+    .param p1, "service"    # Landroid/content/Intent;
+
+    .prologue
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    if-eqz v0, :cond_0
+
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    invoke-interface {v0, p1}, Lcom/android/server/am/PreventRunningHook;->hookBindService(Landroid/content/Intent;)Z
+
+    move-result v0
+
+    :goto_0
+    return v0
+
+    :cond_0
+    const/4 v0, 0x1
+
+    goto :goto_0
+.end method
+
+.method public hookStartProcessLocked(Landroid/content/Context;Landroid/content/pm/ApplicationInfo;Ljava/lang/String;Landroid/content/ComponentName;)Z
+    .locals 1
+    .param p1, "context"    # Landroid/content/Context;
+    .param p2, "info"    # Landroid/content/pm/ApplicationInfo;
+    .param p3, "hostingType"    # Ljava/lang/String;
+    .param p4, "hostingName"    # Landroid/content/ComponentName;
+
+    .prologue
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    if-eqz v0, :cond_0
+
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    invoke-interface {v0, p1, p2, p3, p4}, Lcom/android/server/am/PreventRunningHook;->hookStartProcessLocked(Landroid/content/Context;Landroid/content/pm/ApplicationInfo;Ljava/lang/String;Landroid/content/ComponentName;)Z
+
+    move-result v0
+
+    :goto_0
+    return v0
+
+    :cond_0
+    const/4 v0, 0x1
+
+    goto :goto_0
+.end method
+
+.method public hookStartService(Landroid/content/Intent;)Z
+    .locals 1
+    .param p1, "service"    # Landroid/content/Intent;
+
+    .prologue
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    if-eqz v0, :cond_0
+
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    invoke-interface {v0, p1}, Lcom/android/server/am/PreventRunningHook;->hookStartService(Landroid/content/Intent;)Z
+
+    move-result v0
+
+    :goto_0
+    return v0
+
+    :cond_0
+    const/4 v0, 0x1
+
+    goto :goto_0
+.end method
+
+.method public isActiviated()Z
+    .locals 1
+
+    .prologue
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    if-eqz v0, :cond_0
+
+    const/4 v0, 0x1
+
+    :goto_0
+    return v0
+
+    :cond_0
+    const/4 v0, 0x0
+
+    goto :goto_0
+.end method
+
+.method public isExcludingStopped(Ljava/lang/String;)Z
+    .locals 1
+    .param p1, "action"    # Ljava/lang/String;
+
+    .prologue
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    if-eqz v0, :cond_0
+
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    invoke-interface {v0, p1}, Lcom/android/server/am/PreventRunningHook;->isExcludingStopped(Ljava/lang/String;)Z
+
+    move-result v0
+
+    :goto_0
+    return v0
+
+    :cond_0
+    const/4 v0, 0x1
+
+    goto :goto_0
+.end method
+
+.method public match(ILjava/lang/Object;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Landroid/net/Uri;Ljava/util/Set;)I
+    .locals 8
+    .param p1, "match"    # I
+    .param p2, "filter"    # Ljava/lang/Object;
+    .param p3, "action"    # Ljava/lang/String;
+    .param p4, "type"    # Ljava/lang/String;
+    .param p5, "scheme"    # Ljava/lang/String;
+    .param p6, "data"    # Landroid/net/Uri;
+    .annotation system Ldalvik/annotation/Signature;
+        value = {
+            "(I",
+            "Ljava/lang/Object;",
+            "Ljava/lang/String;",
+            "Ljava/lang/String;",
+            "Ljava/lang/String;",
+            "Landroid/net/Uri;",
+            "Ljava/util/Set",
+            "<",
+            "Ljava/lang/String;",
+            ">;)I"
+        }
+    .end annotation
+
+    .prologue
+    .local p7, "categories":Ljava/util/Set;, "Ljava/util/Set<Ljava/lang/String;>;"
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    if-eqz v0, :cond_0
+
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    move v1, p1
+
+    move-object v2, p2
+
+    move-object v3, p3
+
+    move-object v4, p4
+
+    move-object v5, p5
+
+    move-object v6, p6
+
+    move-object v7, p7
+
+    invoke-interface/range {v0 .. v7}, Lcom/android/server/am/PreventRunningHook;->match(ILjava/lang/Object;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Landroid/net/Uri;Ljava/util/Set;)I
+
+    move-result v0
+
+    return v0
+
+    :cond_0
+    return p1
+.end method
+
+.method public onAppDied(Ljava/lang/Object;)V
+    .locals 1
+    .param p1, "processRecord"    # Ljava/lang/Object;
+
+    .prologue
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    if-eqz v0, :cond_0
+
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    invoke-interface {v0, p1}, Lcom/android/server/am/PreventRunningHook;->onAppDied(Ljava/lang/Object;)V
+
+    :cond_0
+    return-void
+.end method
+
+.method public onBroadcastIntent(Landroid/content/Intent;)V
+    .locals 1
+    .param p1, "intent"    # Landroid/content/Intent;
+
+    .prologue
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    if-eqz v0, :cond_0
+
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    invoke-interface {v0, p1}, Lcom/android/server/am/PreventRunningHook;->onBroadcastIntent(Landroid/content/Intent;)V
+
+    :cond_0
+    return-void
+.end method
+
+.method public onCleanUpRemovedTask(Ljava/lang/String;)V
+    .locals 1
+    .param p1, "packageName"    # Ljava/lang/String;
+
+    .prologue
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    if-eqz v0, :cond_0
+
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    invoke-interface {v0, p1}, Lcom/android/server/am/PreventRunningHook;->onCleanUpRemovedTask(Ljava/lang/String;)V
+
+    :cond_0
+    return-void
+.end method
+
+.method public onDestroyActivity(Ljava/lang/Object;)V
+    .locals 1
+    .param p1, "activityRecord"    # Ljava/lang/Object;
+
+    .prologue
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    if-eqz v0, :cond_0
+
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    invoke-interface {v0, p1}, Lcom/android/server/am/PreventRunningHook;->onDestroyActivity(Ljava/lang/Object;)V
+
+    :cond_0
+    return-void
+.end method
+
+.method public onLaunchActivity(Ljava/lang/Object;)V
+    .locals 1
+    .param p1, "activityRecord"    # Ljava/lang/Object;
+
+    .prologue
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    if-eqz v0, :cond_0
+
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    invoke-interface {v0, p1}, Lcom/android/server/am/PreventRunningHook;->onLaunchActivity(Ljava/lang/Object;)V
+
+    :cond_0
+    return-void
+.end method
+
+.method public onMoveActivityTaskToBack(Ljava/lang/String;)V
+    .locals 1
+    .param p1, "packageName"    # Ljava/lang/String;
+
+    .prologue
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    if-eqz v0, :cond_0
+
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    invoke-interface {v0, p1}, Lcom/android/server/am/PreventRunningHook;->onMoveActivityTaskToBack(Ljava/lang/String;)V
+
+    :cond_0
+    return-void
+.end method
+
+.method public onResumeActivity(Ljava/lang/Object;)V
+    .locals 1
+    .param p1, "activityRecord"    # Ljava/lang/Object;
+
+    .prologue
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    if-eqz v0, :cond_0
+
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    invoke-interface {v0, p1}, Lcom/android/server/am/PreventRunningHook;->onResumeActivity(Ljava/lang/Object;)V
+
+    :cond_0
+    return-void
+.end method
+
+.method public onStartHomeActivity(Ljava/lang/String;)V
+    .locals 1
+    .param p1, "packageName"    # Ljava/lang/String;
+
+    .prologue
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    if-eqz v0, :cond_0
+
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    invoke-interface {v0, p1}, Lcom/android/server/am/PreventRunningHook;->onStartHomeActivity(Ljava/lang/String;)V
+
+    :cond_0
+    return-void
+.end method
+
+.method public onUserLeavingActivity(Ljava/lang/Object;)V
+    .locals 1
+    .param p1, "activityRecord"    # Ljava/lang/Object;
+
+    .prologue
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    if-eqz v0, :cond_0
+
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    invoke-interface {v0, p1}, Lcom/android/server/am/PreventRunningHook;->onUserLeavingActivity(Ljava/lang/Object;)V
+
+    :cond_0
+    return-void
+.end method
+
+.method public setMethod(Ljava/lang/String;)V
+    .locals 1
+    .param p1, "method"    # Ljava/lang/String;
+
+    .prologue
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    if-eqz v0, :cond_0
+
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    invoke-interface {v0, p1}, Lcom/android/server/am/PreventRunningHook;->setMethod(Ljava/lang/String;)V
+
+    :cond_0
+    return-void
+.end method
+
+.method public setSender(Ljava/lang/String;)V
+    .locals 1
+    .param p1, "sender"    # Ljava/lang/String;
+
+    .prologue
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    if-eqz v0, :cond_0
+
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    invoke-interface {v0, p1}, Lcom/android/server/am/PreventRunningHook;->setSender(Ljava/lang/String;)V
+
+    :cond_0
+    return-void
+.end method
+
+.method public setVersion(I)V
+    .locals 1
+    .param p1, "version"    # I
+
+    .prologue
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    if-eqz v0, :cond_0
+
+    iget-object v0, p0, Lcom/android/server/am/PreventRunning;->mPreventRunning:Lcom/android/server/am/PreventRunningHook;
+
+    invoke-interface {v0, p1}, Lcom/android/server/am/PreventRunningHook;->setVersion(I)V
+
+    :cond_0
+    return-void
+.end method
diff --git a/smali/com/android/server/am/PreventRunningHook.smali b/smali/com/android/server/am/PreventRunningHook.smali
new file mode 100644
index 0000000..d7ea660
--- /dev/null
+++ b/smali/com/android/server/am/PreventRunningHook.smali
@@ -0,0 +1,70 @@
+.class public interface abstract Lcom/android/server/am/PreventRunningHook;
+.super Ljava/lang/Object;
+.source "PreventRunningHook.java"
+
+
+# virtual methods
+.method public abstract hookBindService(Landroid/content/Intent;)Z
+.end method
+
+.method public abstract hookStartProcessLocked(Landroid/content/Context;Landroid/content/pm/ApplicationInfo;Ljava/lang/String;Landroid/content/ComponentName;)Z
+.end method
+
+.method public abstract hookStartService(Landroid/content/Intent;)Z
+.end method
+
+.method public abstract isExcludingStopped(Ljava/lang/String;)Z
+.end method
+
+.method public abstract match(ILjava/lang/Object;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Landroid/net/Uri;Ljava/util/Set;)I
+    .annotation system Ldalvik/annotation/Signature;
+        value = {
+            "(I",
+            "Ljava/lang/Object;",
+            "Ljava/lang/String;",
+            "Ljava/lang/String;",
+            "Ljava/lang/String;",
+            "Landroid/net/Uri;",
+            "Ljava/util/Set",
+            "<",
+            "Ljava/lang/String;",
+            ">;)I"
+        }
+    .end annotation
+.end method
+
+.method public abstract onAppDied(Ljava/lang/Object;)V
+.end method
+
+.method public abstract onBroadcastIntent(Landroid/content/Intent;)V
+.end method
+
+.method public abstract onCleanUpRemovedTask(Ljava/lang/String;)V
+.end method
+
+.method public abstract onDestroyActivity(Ljava/lang/Object;)V
+.end method
+
+.method public abstract onLaunchActivity(Ljava/lang/Object;)V
+.end method
+
+.method public abstract onMoveActivityTaskToBack(Ljava/lang/String;)V
+.end method
+
+.method public abstract onResumeActivity(Ljava/lang/Object;)V
+.end method
+
+.method public abstract onStartHomeActivity(Ljava/lang/String;)V
+.end method
+
+.method public abstract onUserLeavingActivity(Ljava/lang/Object;)V
+.end method
+
+.method public abstract setMethod(Ljava/lang/String;)V
+.end method
+
+.method public abstract setSender(Ljava/lang/String;)V
+.end method
+
+.method public abstract setVersion(I)V
+.end method
diff --git a/smali/com/android/server/am/PreventRunningUtils.smali b/smali/com/android/server/am/PreventRunningUtils.smali
new file mode 100644
index 0000000..2136c83
--- /dev/null
+++ b/smali/com/android/server/am/PreventRunningUtils.smali
@@ -0,0 +1,488 @@
+.class public Lcom/android/server/am/PreventRunningUtils;
+.super Ljava/lang/Object;
+.source "PreventRunningUtils.java"
+
+
+# static fields
+.field private static ams:Lcom/android/server/am/ActivityManagerService;
+
+.field private static mPreventRunning:Lcom/android/server/am/PreventRunning;
+
+
+# direct methods
+.method static constructor <clinit>()V
+    .locals 1
+
+    .prologue
+    new-instance v0, Lcom/android/server/am/PreventRunning;
+
+    invoke-direct {v0}, Lcom/android/server/am/PreventRunning;-><init>()V
+
+    sput-object v0, Lcom/android/server/am/PreventRunningUtils;->mPreventRunning:Lcom/android/server/am/PreventRunning;
+
+    return-void
+.end method
+
+.method private constructor <init>()V
+    .locals 0
+
+    .prologue
+    invoke-direct {p0}, Ljava/lang/Object;-><init>()V
+
+    return-void
+.end method
+
+.method public static clearSender()V
+    .locals 2
+
+    .prologue
+    sget-object v0, Lcom/android/server/am/PreventRunningUtils;->mPreventRunning:Lcom/android/server/am/PreventRunning;
+
+    const/4 v1, 0x0
+
+    invoke-virtual {v0, v1}, Lcom/android/server/am/PreventRunning;->setSender(Ljava/lang/String;)V
+
+    return-void
+.end method
+
+.method private static forToken(Landroid/os/IBinder;)Lcom/android/server/am/ActivityRecord;
+    .locals 1
+    .param p0, "token"    # Landroid/os/IBinder;
+
+    .prologue
+    invoke-static {p0}, Lcom/android/server/am/ActivityRecord;->forTokenLocked(Landroid/os/IBinder;)Lcom/android/server/am/ActivityRecord;
+
+    move-result-object v0
+
+    return-object v0
+.end method
+
+.method private static getAms()Lcom/android/server/am/ActivityManagerService;
+    .locals 1
+
+    .prologue
+    sget-object v0, Lcom/android/server/am/PreventRunningUtils;->ams:Lcom/android/server/am/ActivityManagerService;
+
+    if-nez v0, :cond_0
+
+    const-string/jumbo v0, "activity"
+
+    invoke-static {v0}, Landroid/os/ServiceManager;->getService(Ljava/lang/String;)Landroid/os/IBinder;
+
+    move-result-object v0
+
+    check-cast v0, Lcom/android/server/am/ActivityManagerService;
+
+    sput-object v0, Lcom/android/server/am/PreventRunningUtils;->ams:Lcom/android/server/am/ActivityManagerService;
+
+    :cond_0
+    sget-object v0, Lcom/android/server/am/PreventRunningUtils;->ams:Lcom/android/server/am/ActivityManagerService;
+
+    return-object v0
+.end method
+
+.method public static hookBindService(Landroid/app/IApplicationThread;Landroid/os/IBinder;Landroid/content/Intent;)Z
+    .locals 1
+    .param p0, "caller"    # Landroid/app/IApplicationThread;
+    .param p1, "token"    # Landroid/os/IBinder;
+    .param p2, "service"    # Landroid/content/Intent;
+
+    .prologue
+    sget-object v0, Lcom/android/server/am/PreventRunningUtils;->mPreventRunning:Lcom/android/server/am/PreventRunning;
+
+    invoke-virtual {v0, p2}, Lcom/android/server/am/PreventRunning;->hookBindService(Landroid/content/Intent;)Z
+
+    move-result v0
+
+    return v0
+.end method
+
+.method public static hookStartProcessLocked(Ljava/lang/String;Landroid/content/pm/ApplicationInfo;ZILjava/lang/String;Landroid/content/ComponentName;)Z
+    .locals 2
+    .param p0, "processName"    # Ljava/lang/String;
+    .param p1, "info"    # Landroid/content/pm/ApplicationInfo;
+    .param p2, "knownToBeDead"    # Z
+    .param p3, "intentFlags"    # I
+    .param p4, "hostingType"    # Ljava/lang/String;
+    .param p5, "hostingName"    # Landroid/content/ComponentName;
+
+    .prologue
+    sget-object v0, Lcom/android/server/am/PreventRunningUtils;->mPreventRunning:Lcom/android/server/am/PreventRunning;
+
+    invoke-static {}, Lcom/android/server/am/PreventRunningUtils;->getAms()Lcom/android/server/am/ActivityManagerService;
+
+    move-result-object v1
+
+    iget-object v1, v1, Lcom/android/server/am/ActivityManagerService;->mContext:Landroid/content/Context;
+
+    invoke-virtual {v0, v1, p1, p4, p5}, Lcom/android/server/am/PreventRunning;->hookStartProcessLocked(Landroid/content/Context;Landroid/content/pm/ApplicationInfo;Ljava/lang/String;Landroid/content/ComponentName;)Z
+
+    move-result v0
+
+    return v0
+.end method
+
+.method public static hookStartService(Landroid/app/IApplicationThread;Landroid/content/Intent;)Z
+    .locals 1
+    .param p0, "caller"    # Landroid/app/IApplicationThread;
+    .param p1, "service"    # Landroid/content/Intent;
+
+    .prologue
+    sget-object v0, Lcom/android/server/am/PreventRunningUtils;->mPreventRunning:Lcom/android/server/am/PreventRunning;
+
+    invoke-virtual {v0, p1}, Lcom/android/server/am/PreventRunning;->hookStartService(Landroid/content/Intent;)Z
+
+    move-result v0
+
+    return v0
+.end method
+
+.method public static isExcludingStopped(Landroid/content/Intent;)Z
+    .locals 2
+    .param p0, "intent"    # Landroid/content/Intent;
+
+    .prologue
+    invoke-virtual {p0}, Landroid/content/Intent;->getAction()Ljava/lang/String;
+
+    move-result-object v0
+
+    .local v0, "action":Ljava/lang/String;
+    invoke-virtual {p0}, Landroid/content/Intent;->isExcludingStopped()Z
+
+    move-result v1
+
+    if-eqz v1, :cond_0
+
+    if-eqz v0, :cond_0
+
+    sget-object v1, Lcom/android/server/am/PreventRunningUtils;->mPreventRunning:Lcom/android/server/am/PreventRunning;
+
+    invoke-virtual {v1, v0}, Lcom/android/server/am/PreventRunning;->isExcludingStopped(Ljava/lang/String;)Z
+
+    move-result v1
+
+    :goto_0
+    return v1
+
+    :cond_0
+    const/4 v1, 0x0
+
+    goto :goto_0
+.end method
+
+.method public static match(Landroid/content/IntentFilter;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Landroid/net/Uri;Ljava/util/Set;Ljava/lang/String;)I
+    .locals 8
+    .param p0, "filter"    # Landroid/content/IntentFilter;
+    .param p1, "action"    # Ljava/lang/String;
+    .param p2, "type"    # Ljava/lang/String;
+    .param p3, "scheme"    # Ljava/lang/String;
+    .param p4, "data"    # Landroid/net/Uri;
+    .param p6, "tag"    # Ljava/lang/String;
+    .annotation system Ldalvik/annotation/Signature;
+        value = {
+            "(",
+            "Landroid/content/IntentFilter;",
+            "Ljava/lang/String;",
+            "Ljava/lang/String;",
+            "Ljava/lang/String;",
+            "Landroid/net/Uri;",
+            "Ljava/util/Set",
+            "<",
+            "Ljava/lang/String;",
+            ">;",
+            "Ljava/lang/String;",
+            ")I"
+        }
+    .end annotation
+
+    .prologue
+    .local p5, "categories":Ljava/util/Set;, "Ljava/util/Set<Ljava/lang/String;>;"
+    invoke-virtual/range {p0 .. p6}, Landroid/content/IntentFilter;->match(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Landroid/net/Uri;Ljava/util/Set;Ljava/lang/String;)I
+
+    move-result v1
+
+    .local v1, "match":I
+    if-ltz v1, :cond_0
+
+    sget-object v0, Lcom/android/server/am/PreventRunningUtils;->mPreventRunning:Lcom/android/server/am/PreventRunning;
+
+    move-object v2, p0
+
+    move-object v3, p1
+
+    move-object v4, p2
+
+    move-object v5, p3
+
+    move-object v6, p4
+
+    move-object v7, p5
+
+    invoke-virtual/range {v0 .. v7}, Lcom/android/server/am/PreventRunning;->match(ILjava/lang/Object;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Landroid/net/Uri;Ljava/util/Set;)I
+
+    move-result v0
+
+    return v0
+
+    :cond_0
+    return v1
+.end method
+
+.method public static onAppDied(Lcom/android/server/am/ProcessRecord;)V
+    .locals 1
+    .param p0, "app"    # Lcom/android/server/am/ProcessRecord;
+
+    .prologue
+    sget-object v0, Lcom/android/server/am/PreventRunningUtils;->mPreventRunning:Lcom/android/server/am/PreventRunning;
+
+    invoke-virtual {v0, p0}, Lcom/android/server/am/PreventRunning;->onAppDied(Ljava/lang/Object;)V
+
+    return-void
+.end method
+
+.method public static onBroadcastIntent(Landroid/content/Intent;)V
+    .locals 1
+    .param p0, "intent"    # Landroid/content/Intent;
+
+    .prologue
+    sget-object v0, Lcom/android/server/am/PreventRunningUtils;->mPreventRunning:Lcom/android/server/am/PreventRunning;
+
+    invoke-virtual {v0, p0}, Lcom/android/server/am/PreventRunning;->onBroadcastIntent(Landroid/content/Intent;)V
+
+    return-void
+.end method
+
+.method public static onCleanUpRemovedTask(Landroid/content/Intent;)V
+    .locals 2
+    .param p0, "intent"    # Landroid/content/Intent;
+
+    .prologue
+    if-eqz p0, :cond_0
+
+    invoke-virtual {p0}, Landroid/content/Intent;->getComponent()Landroid/content/ComponentName;
+
+    move-result-object v0
+
+    if-eqz v0, :cond_0
+
+    sget-object v0, Lcom/android/server/am/PreventRunningUtils;->mPreventRunning:Lcom/android/server/am/PreventRunning;
+
+    invoke-virtual {p0}, Landroid/content/Intent;->getComponent()Landroid/content/ComponentName;
+
+    move-result-object v1
+
+    invoke-virtual {v1}, Landroid/content/ComponentName;->getPackageName()Ljava/lang/String;
+
+    move-result-object v1
+
+    invoke-virtual {v0, v1}, Lcom/android/server/am/PreventRunning;->onCleanUpRemovedTask(Ljava/lang/String;)V
+
+    :cond_0
+    return-void
+.end method
+
+.method public static onDestroyActivity(Landroid/os/IBinder;)V
+    .locals 2
+    .param p0, "token"    # Landroid/os/IBinder;
+
+    .prologue
+    sget-object v0, Lcom/android/server/am/PreventRunningUtils;->mPreventRunning:Lcom/android/server/am/PreventRunning;
+
+    invoke-static {p0}, Lcom/android/server/am/PreventRunningUtils;->forToken(Landroid/os/IBinder;)Lcom/android/server/am/ActivityRecord;
+
+    move-result-object v1
+
+    invoke-virtual {v0, v1}, Lcom/android/server/am/PreventRunning;->onDestroyActivity(Ljava/lang/Object;)V
+
+    return-void
+.end method
+
+.method public static onLaunchActivity(Landroid/os/IBinder;)V
+    .locals 2
+    .param p0, "token"    # Landroid/os/IBinder;
+
+    .prologue
+    sget-object v0, Lcom/android/server/am/PreventRunningUtils;->mPreventRunning:Lcom/android/server/am/PreventRunning;
+
+    invoke-static {p0}, Lcom/android/server/am/PreventRunningUtils;->forToken(Landroid/os/IBinder;)Lcom/android/server/am/ActivityRecord;
+
+    move-result-object v1
+
+    invoke-virtual {v0, v1}, Lcom/android/server/am/PreventRunning;->onLaunchActivity(Ljava/lang/Object;)V
+
+    return-void
+.end method
+
+.method public static onMoveActivityTaskToBack(Landroid/os/IBinder;)V
+    .locals 3
+    .param p0, "token"    # Landroid/os/IBinder;
+
+    .prologue
+    const/4 v1, 0x0
+
+    invoke-static {p0}, Lcom/android/server/am/PreventRunningUtils;->forToken(Landroid/os/IBinder;)Lcom/android/server/am/ActivityRecord;
+
+    move-result-object v0
+
+    .local v0, "ar":Lcom/android/server/am/ActivityRecord;
+    sget-object v2, Lcom/android/server/am/PreventRunningUtils;->mPreventRunning:Lcom/android/server/am/PreventRunning;
+
+    if-eqz v0, :cond_0
+
+    iget-object v1, v0, Lcom/android/server/am/ActivityRecord;->packageName:Ljava/lang/String;
+
+    :cond_0
+    invoke-virtual {v2, v1}, Lcom/android/server/am/PreventRunning;->onMoveActivityTaskToBack(Ljava/lang/String;)V
+
+    return-void
+.end method
+
+.method public static onResumeActivity(Landroid/os/IBinder;)V
+    .locals 2
+    .param p0, "token"    # Landroid/os/IBinder;
+
+    .prologue
+    sget-object v0, Lcom/android/server/am/PreventRunningUtils;->mPreventRunning:Lcom/android/server/am/PreventRunning;
+
+    invoke-static {p0}, Lcom/android/server/am/PreventRunningUtils;->forToken(Landroid/os/IBinder;)Lcom/android/server/am/ActivityRecord;
+
+    move-result-object v1
+
+    invoke-virtual {v0, v1}, Lcom/android/server/am/PreventRunning;->onResumeActivity(Ljava/lang/Object;)V
+
+    return-void
+.end method
+
+.method public static onStartActivity(ILandroid/app/IApplicationThread;Ljava/lang/String;Landroid/content/Intent;)I
+    .locals 3
+    .param p0, "res"    # I
+    .param p1, "caller"    # Landroid/app/IApplicationThread;
+    .param p2, "callingPackage"    # Ljava/lang/String;
+    .param p3, "intent"    # Landroid/content/Intent;
+
+    .prologue
+    if-ltz p0, :cond_1
+
+    if-eqz p3, :cond_1
+
+    const-string/jumbo v1, "android.intent.category.HOME"
+
+    invoke-virtual {p3, v1}, Landroid/content/Intent;->hasCategory(Ljava/lang/String;)Z
+
+    move-result v1
+
+    if-nez v1, :cond_0
+
+    const-string/jumbo v1, "android.intent.category.LAUNCHER"
+
+    invoke-virtual {p3, v1}, Landroid/content/Intent;->hasCategory(Ljava/lang/String;)Z
+
+    move-result v1
+
+    if-eqz v1, :cond_1
+
+    :cond_0
+    invoke-static {}, Lcom/android/server/am/PreventRunningUtils;->getAms()Lcom/android/server/am/ActivityManagerService;
+
+    move-result-object v1
+
+    invoke-virtual {v1, p1}, Lcom/android/server/am/ActivityManagerService;->getRecordForAppLocked(Landroid/app/IApplicationThread;)Lcom/android/server/am/ProcessRecord;
+
+    move-result-object v0
+
+    .local v0, "callerApp":Lcom/android/server/am/ProcessRecord;
+    if-eqz v0, :cond_1
+
+    sget-object v1, Lcom/android/server/am/PreventRunningUtils;->mPreventRunning:Lcom/android/server/am/PreventRunning;
+
+    iget-object v2, v0, Lcom/android/server/am/ProcessRecord;->info:Landroid/content/pm/ApplicationInfo;
+
+    iget-object v2, v2, Landroid/content/pm/ApplicationInfo;->packageName:Ljava/lang/String;
+
+    invoke-virtual {v1, v2}, Lcom/android/server/am/PreventRunning;->onStartHomeActivity(Ljava/lang/String;)V
+
+    .end local v0    # "callerApp":Lcom/android/server/am/ProcessRecord;
+    :cond_1
+    return p0
+.end method
+
+.method public static onUserLeavingActivity(Landroid/os/IBinder;ZZ)V
+    .locals 2
+    .param p0, "token"    # Landroid/os/IBinder;
+    .param p1, "finishing"    # Z
+    .param p2, "userLeaving"    # Z
+
+    .prologue
+    if-eqz p2, :cond_0
+
+    sget-object v0, Lcom/android/server/am/PreventRunningUtils;->mPreventRunning:Lcom/android/server/am/PreventRunning;
+
+    invoke-static {p0}, Lcom/android/server/am/PreventRunningUtils;->forToken(Landroid/os/IBinder;)Lcom/android/server/am/ActivityRecord;
+
+    move-result-object v1
+
+    invoke-virtual {v0, v1}, Lcom/android/server/am/PreventRunning;->onUserLeavingActivity(Ljava/lang/Object;)V
+
+    :cond_0
+    return-void
+.end method
+
+.method public static returnFalse(Z)Z
+    .locals 1
+    .param p0, "res"    # Z
+
+    .prologue
+    sget-object v0, Lcom/android/server/am/PreventRunningUtils;->mPreventRunning:Lcom/android/server/am/PreventRunning;
+
+    invoke-virtual {v0}, Lcom/android/server/am/PreventRunning;->isActiviated()Z
+
+    move-result v0
+
+    if-eqz v0, :cond_0
+
+    const/4 v0, 0x0
+
+    return v0
+
+    :cond_0
+    return p0
+.end method
+
+.method public static setSender(Landroid/app/IApplicationThread;)V
+    .locals 3
+    .param p0, "caller"    # Landroid/app/IApplicationThread;
+
+    .prologue
+    invoke-static {}, Lcom/android/server/am/PreventRunningUtils;->getAms()Lcom/android/server/am/ActivityManagerService;
+
+    move-result-object v1
+
+    invoke-virtual {v1, p0}, Lcom/android/server/am/ActivityManagerService;->getRecordForAppLocked(Landroid/app/IApplicationThread;)Lcom/android/server/am/ProcessRecord;
+
+    move-result-object v0
+
+    .local v0, "callerApp":Lcom/android/server/am/ProcessRecord;
+    sget-object v2, Lcom/android/server/am/PreventRunningUtils;->mPreventRunning:Lcom/android/server/am/PreventRunning;
+
+    if-eqz v0, :cond_0
+
+    iget-object v1, v0, Lcom/android/server/am/ProcessRecord;->info:Landroid/content/pm/ApplicationInfo;
+
+    iget-object v1, v1, Landroid/content/pm/ApplicationInfo;->packageName:Ljava/lang/String;
+
+    :goto_0
+    invoke-virtual {v2, v1}, Lcom/android/server/am/PreventRunning;->setSender(Ljava/lang/String;)V
+
+    return-void
+
+    :cond_0
+    invoke-static {}, Landroid/os/Binder;->getCallingUid()I
+
+    move-result v1
+
+    invoke-static {v1}, Ljava/lang/String;->valueOf(I)Ljava/lang/String;
+
+    move-result-object v1
+
+    goto :goto_0
+.end method
diff --git a/smali/com/android/server/notification/-$Lambda$0oXbfIRCVxclfVVwXaE3J61tRFA$1.smali b/smali/com/android/server/notification/-$Lambda$0oXbfIRCVxclfVVwXaE3J61tRFA$1.smali
index e1e33e9..75fc2ec 100644
--- a/smali/com/android/server/notification/-$Lambda$0oXbfIRCVxclfVVwXaE3J61tRFA$1.smali
+++ b/smali/com/android/server/notification/-$Lambda$0oXbfIRCVxclfVVwXaE3J61tRFA$1.smali
@@ -30,7 +30,7 @@
 
     check-cast v2, Landroid/os/VibrationEffect;
 
-    invoke-virtual {v0, v1, v2}, Lcom/android/server/notification/NotificationManagerService;->lambda$-com_android_server_notification_NotificationManagerService_190836(Lcom/android/server/notification/NotificationRecord;Landroid/os/VibrationEffect;)V
+    invoke-virtual {v0, v1, v2}, Lcom/android/server/notification/NotificationManagerService;->lambda$-com_android_server_notification_NotificationManagerService_191018(Lcom/android/server/notification/NotificationRecord;Landroid/os/VibrationEffect;)V
 
     return-void
 .end method
diff --git a/smali/com/android/server/notification/-$Lambda$0oXbfIRCVxclfVVwXaE3J61tRFA$2.smali b/smali/com/android/server/notification/-$Lambda$0oXbfIRCVxclfVVwXaE3J61tRFA$2.smali
index e4fdd27..b329fa3 100644
--- a/smali/com/android/server/notification/-$Lambda$0oXbfIRCVxclfVVwXaE3J61tRFA$2.smali
+++ b/smali/com/android/server/notification/-$Lambda$0oXbfIRCVxclfVVwXaE3J61tRFA$2.smali
@@ -48,7 +48,7 @@
 
     iget v5, p0, Lcom/android/server/notification/-$Lambda$0oXbfIRCVxclfVVwXaE3J61tRFA$2;->-$f0:I
 
-    invoke-virtual/range {v0 .. v5}, Lcom/android/server/notification/NotificationManagerService$NotificationListeners;->lambda$-com_android_server_notification_NotificationManagerService$NotificationListeners_251931(Lcom/android/server/notification/ManagedServices$ManagedServiceInfo;Ljava/lang/String;Landroid/os/UserHandle;Landroid/app/NotificationChannel;I)V
+    invoke-virtual/range {v0 .. v5}, Lcom/android/server/notification/NotificationManagerService$NotificationListeners;->lambda$-com_android_server_notification_NotificationManagerService$NotificationListeners_252113(Lcom/android/server/notification/ManagedServices$ManagedServiceInfo;Ljava/lang/String;Landroid/os/UserHandle;Landroid/app/NotificationChannel;I)V
 
     return-void
 .end method
@@ -79,7 +79,7 @@
 
     iget v5, p0, Lcom/android/server/notification/-$Lambda$0oXbfIRCVxclfVVwXaE3J61tRFA$2;->-$f0:I
 
-    invoke-virtual/range {v0 .. v5}, Lcom/android/server/notification/NotificationManagerService$NotificationListeners;->lambda$-com_android_server_notification_NotificationManagerService$NotificationListeners_252743(Lcom/android/server/notification/ManagedServices$ManagedServiceInfo;Ljava/lang/String;Landroid/os/UserHandle;Landroid/app/NotificationChannelGroup;I)V
+    invoke-virtual/range {v0 .. v5}, Lcom/android/server/notification/NotificationManagerService$NotificationListeners;->lambda$-com_android_server_notification_NotificationManagerService$NotificationListeners_252925(Lcom/android/server/notification/ManagedServices$ManagedServiceInfo;Ljava/lang/String;Landroid/os/UserHandle;Landroid/app/NotificationChannelGroup;I)V
 
     return-void
 .end method
diff --git a/smali/com/android/server/notification/-$Lambda$0oXbfIRCVxclfVVwXaE3J61tRFA$3.smali b/smali/com/android/server/notification/-$Lambda$0oXbfIRCVxclfVVwXaE3J61tRFA$3.smali
index 071ceb4..a143c2d 100644
--- a/smali/com/android/server/notification/-$Lambda$0oXbfIRCVxclfVVwXaE3J61tRFA$3.smali
+++ b/smali/com/android/server/notification/-$Lambda$0oXbfIRCVxclfVVwXaE3J61tRFA$3.smali
@@ -21,7 +21,7 @@
 
     iget v1, p0, Lcom/android/server/notification/-$Lambda$0oXbfIRCVxclfVVwXaE3J61tRFA$3;->-$f1:I
 
-    invoke-static {v0, v1, p1}, Lcom/android/server/notification/NotificationManagerService$16;->lambda$-com_android_server_notification_NotificationManagerService$16_216771(III)Z
+    invoke-static {v0, v1, p1}, Lcom/android/server/notification/NotificationManagerService$16;->lambda$-com_android_server_notification_NotificationManagerService$16_216953(III)Z
 
     move-result v0
 
diff --git a/smali/com/android/server/notification/-$Lambda$0oXbfIRCVxclfVVwXaE3J61tRFA.smali b/smali/com/android/server/notification/-$Lambda$0oXbfIRCVxclfVVwXaE3J61tRFA.smali
index 04190e4..53a0f1e 100644
--- a/smali/com/android/server/notification/-$Lambda$0oXbfIRCVxclfVVwXaE3J61tRFA.smali
+++ b/smali/com/android/server/notification/-$Lambda$0oXbfIRCVxclfVVwXaE3J61tRFA.smali
@@ -15,7 +15,7 @@
     .param p1, "arg0"    # I
 
     .prologue
-    invoke-static {p1}, Lcom/android/server/notification/NotificationManagerService$17;->lambda$-com_android_server_notification_NotificationManagerService$17_221945(I)Z
+    invoke-static {p1}, Lcom/android/server/notification/NotificationManagerService$17;->lambda$-com_android_server_notification_NotificationManagerService$17_222127(I)Z
 
     move-result v0
 
diff --git a/smali/com/android/server/notification/NotificationManagerService$16.smali b/smali/com/android/server/notification/NotificationManagerService$16.smali
index 1fb64ce..13e498a 100644
--- a/smali/com/android/server/notification/NotificationManagerService$16.smali
+++ b/smali/com/android/server/notification/NotificationManagerService$16.smali
@@ -74,7 +74,7 @@
     return-void
 .end method
 
-.method static synthetic lambda$-com_android_server_notification_NotificationManagerService$16_216771(III)Z
+.method static synthetic lambda$-com_android_server_notification_NotificationManagerService$16_216953(III)Z
     .locals 2
     .param p0, "mustHaveFlags"    # I
     .param p1, "mustNotHaveFlags"    # I
diff --git a/smali/com/android/server/notification/NotificationManagerService$17.smali b/smali/com/android/server/notification/NotificationManagerService$17.smali
index c6316b2..71e7561 100644
--- a/smali/com/android/server/notification/NotificationManagerService$17.smali
+++ b/smali/com/android/server/notification/NotificationManagerService$17.smali
@@ -58,7 +58,7 @@
     return-void
 .end method
 
-.method static synthetic lambda$-com_android_server_notification_NotificationManagerService$17_221945(I)Z
+.method static synthetic lambda$-com_android_server_notification_NotificationManagerService$17_222127(I)Z
     .locals 2
     .param p0, "flags"    # I
 
diff --git a/smali/com/android/server/notification/NotificationManagerService$7.smali b/smali/com/android/server/notification/NotificationManagerService$7.smali
index 95c0452..fd479e8 100644
--- a/smali/com/android/server/notification/NotificationManagerService$7.smali
+++ b/smali/com/android/server/notification/NotificationManagerService$7.smali
@@ -4562,6 +4562,29 @@
     return v0
 .end method
 
+.method public getPriority(Ljava/lang/String;I)I
+    .locals 1
+    .param p1, "pkg"    # Ljava/lang/String;
+    .param p2, "uid"    # I
+
+    .prologue
+    iget-object v0, p0, Lcom/android/server/notification/NotificationManagerService$7;->this$0:Lcom/android/server/notification/NotificationManagerService;
+
+    invoke-static {v0}, Lcom/android/server/notification/NotificationManagerService;->-wrap20(Lcom/android/server/notification/NotificationManagerService;)V
+
+    iget-object v0, p0, Lcom/android/server/notification/NotificationManagerService$7;->this$0:Lcom/android/server/notification/NotificationManagerService;
+
+    invoke-static {v0}, Lcom/android/server/notification/NotificationManagerService;->-get27(Lcom/android/server/notification/NotificationManagerService;)Lcom/android/server/notification/RankingHelper;
+
+    move-result-object v0
+
+    invoke-virtual {v0, p1, p2}, Lcom/android/server/notification/RankingHelper;->getPackagePriority(Ljava/lang/String;I)I
+
+    move-result v0
+
+    return v0
+.end method
+
 .method public getRuleInstanceCount(Landroid/content/ComponentName;)I
     .locals 1
     .param p1, "owner"    # Landroid/content/ComponentName;
diff --git a/smali/com/android/server/notification/NotificationManagerService$NotificationListeners.smali b/smali/com/android/server/notification/NotificationManagerService$NotificationListeners.smali
index e1c635d..de41f08 100644
--- a/smali/com/android/server/notification/NotificationManagerService$NotificationListeners.smali
+++ b/smali/com/android/server/notification/NotificationManagerService$NotificationListeners.smali
@@ -608,7 +608,7 @@
     throw v2
 .end method
 
-.method synthetic lambda$-com_android_server_notification_NotificationManagerService$NotificationListeners_251931(Lcom/android/server/notification/ManagedServices$ManagedServiceInfo;Ljava/lang/String;Landroid/os/UserHandle;Landroid/app/NotificationChannel;I)V
+.method synthetic lambda$-com_android_server_notification_NotificationManagerService$NotificationListeners_252113(Lcom/android/server/notification/ManagedServices$ManagedServiceInfo;Ljava/lang/String;Landroid/os/UserHandle;Landroid/app/NotificationChannel;I)V
     .locals 1
     .param p1, "serviceInfo"    # Lcom/android/server/notification/ManagedServices$ManagedServiceInfo;
     .param p2, "pkg"    # Ljava/lang/String;
@@ -631,7 +631,7 @@
     return-void
 .end method
 
-.method synthetic lambda$-com_android_server_notification_NotificationManagerService$NotificationListeners_252743(Lcom/android/server/notification/ManagedServices$ManagedServiceInfo;Ljava/lang/String;Landroid/os/UserHandle;Landroid/app/NotificationChannelGroup;I)V
+.method synthetic lambda$-com_android_server_notification_NotificationManagerService$NotificationListeners_252925(Lcom/android/server/notification/ManagedServices$ManagedServiceInfo;Ljava/lang/String;Landroid/os/UserHandle;Landroid/app/NotificationChannelGroup;I)V
     .locals 1
     .param p1, "serviceInfo"    # Lcom/android/server/notification/ManagedServices$ManagedServiceInfo;
     .param p2, "pkg"    # Ljava/lang/String;
diff --git a/smali/com/android/server/notification/NotificationManagerService.smali b/smali/com/android/server/notification/NotificationManagerService.smali
index b1efd57..2f96114 100644
--- a/smali/com/android/server/notification/NotificationManagerService.smali
+++ b/smali/com/android/server/notification/NotificationManagerService.smali
@@ -13031,7 +13031,7 @@
     goto :goto_1
 .end method
 
-.method synthetic lambda$-com_android_server_notification_NotificationManagerService_190836(Lcom/android/server/notification/NotificationRecord;Landroid/os/VibrationEffect;)V
+.method synthetic lambda$-com_android_server_notification_NotificationManagerService_191018(Lcom/android/server/notification/NotificationRecord;Landroid/os/VibrationEffect;)V
     .locals 6
     .param p1, "record"    # Lcom/android/server/notification/NotificationRecord;
     .param p2, "effect"    # Landroid/os/VibrationEffect;
diff --git a/smali/com/android/server/notification/RankingHelper.smali b/smali/com/android/server/notification/RankingHelper.smali
index b4ad5b8..11591ee 100644
--- a/smali/com/android/server/notification/RankingHelper.smali
+++ b/smali/com/android/server/notification/RankingHelper.smali
@@ -3100,7 +3100,7 @@
     throw v4
 .end method
 
-.method getPackagePriority(Ljava/lang/String;I)I
+.method public getPackagePriority(Ljava/lang/String;I)I
     .locals 1
     .param p1, "pkg"    # Ljava/lang/String;
     .param p2, "uid"    # I
-- 
2.16.3.windows.1

